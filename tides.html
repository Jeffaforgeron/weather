<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">

<title>Tides ‚Äì Forgeron Weather</title>

<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  margin:0;
  padding:20px;
  background:#020617;
  color:#e5e7eb;
  font-family:system-ui,-apple-system,BlinkMacSystemFont,sans-serif;
}

h1{
  text-align:center;
  margin-bottom:6px;
}

.subtitle{
  text-align:center;
  color:#9ca3af;
  margin-bottom:20px;
}

.card{
  max-width:800px;
  margin:0 auto;
  background:#0b1220;
  border-radius:12px;
  padding:16px;
  box-shadow:0 0 30px rgba(56,189,248,.25);
}

select{
  width:100%;
  padding:8px;
  margin-bottom:12px;
  background:#020617;
  color:#9ca3af;
  border:1px solid rgba(255,255,255,.15);
  border-radius:6px;
}

.tide-row{
  display:flex;
  justify-content:space-between;
  padding:6px 0;
  border-bottom:1px solid rgba(255,255,255,.05);
}

.label{ color:#9ca3af; }

.value{ color:#38bdf8; font-weight:700; }

.footer{
  text-align:center;
  margin-top:30px;
  color:#64748b;
  font-size:12px;
}
</style>
</head>

<body>

<h1>Tidal Forecast</h1>
<div class="subtitle">Simple daily tides</div>

<div class="card">
<div id="tideHeader" style="margin-bottom:14px;">
  <div id="stationName" style="font-size:20px;font-weight:700;"></div>
  <div id="todayDate" style="color:#9ca3af;"></div>
</div>
<!-- STATE DROPDOWN -->
<select id="stateSelect">
  <option value="">Select State</option>
  <option value="WA">Washington</option>
  <option value="OR">Oregon</option>
  <option value="CA">California</option>
  <option value="HI">Hawaii</option>
</select>

<!-- CITY DROPDOWN -->
<select id="citySelect" disabled>
  <option value="">Select City</option>
</select>

<div id="tideData">
  Loading‚Ä¶
</div>

</div>

<div class="footer">
‚Üê <a href="index.html" style="color:#38bdf8">Back to Dashboard</a>
</div>

<script>
const tideBox = document.getElementById("tideData");
const stateSelect = document.getElementById("stateSelect");
const citySelect = document.getElementById("citySelect");
const stationNameBox = document.getElementById("stationName");
const todayDateBox = document.getElementById("todayDate");
async function loadTides(){

  tideBox.innerHTML = "Loading‚Ä¶";

const station = citySelect.value;
// Set station name
stationNameBox.textContent =
  citySelect.options[citySelect.selectedIndex].text;

// Set today's date
const todayReadable = new Date().toLocaleDateString(undefined,{
  weekday:"long",
  month:"long",
  day:"numeric"
});
todayDateBox.textContent = todayReadable;
  const d = new Date();
  const today =
    d.getFullYear().toString() +
    String(d.getMonth()+1).padStart(2,"0") +
    String(d.getDate()).padStart(2,"0");

  const url =
    "https://api.tidesandcurrents.noaa.gov/api/prod/datagetter" +
    "?product=predictions" +
    "&application=forgeron" +
    "&begin_date=" + today +
    "&end_date=" + today +
    "&datum=MLLW" +
    "&station=" + station +
    "&time_zone=lst_ldt" +
    "&units=english" +
    "&interval=hilo" +
    "&format=json";

  try{

    const r = await fetch(url);
    const j = await r.json();

    tideBox.innerHTML = "";

    const now = new Date();
 
    let nextHigh = null;
    let nextLow = null;

    j.predictions.forEach(p=>{
      const t = new Date(p.t.replace(" ","T"));
      if(t > now){
        if(p.type==="H" && !nextHigh) nextHigh = p;
        if(p.type==="L" && !nextLow) nextLow = p;
      }
    });
   // Determine rising or falling
let trend = "‚Äî";

if(nextHigh && nextLow){
  const nextHighTime = new Date(nextHigh.t.replace(" ","T"));
  const nextLowTime = new Date(nextLow.t.replace(" ","T"));
  

  trend = nextHighTime < nextLowTime ? "Rising" : "Falling";
}
    const summary = document.createElement("div");
    summary.style.marginBottom="14px";
    summary.style.paddingBottom="10px";
    summary.style.borderBottom="1px solid rgba(255,255,255,.1)";

 summary.innerHTML = `
  <div style="font-size:20px;margin-bottom:10px;">
    üåä <strong>${trend}</strong>
  </div>

  <div style="font-size:18px;margin-bottom:6px;">
    <strong>Next High:</strong> ${
      nextHigh ? nextHigh.t.slice(11,16)+" ‚Ä¢ "+nextHigh.v+" ft" : "‚Äî"
    }
  </div>

  <div style="font-size:18px;">
    <strong>Next Low:</strong> ${
      nextLow ? nextLow.t.slice(11,16)+" ‚Ä¢ "+nextLow.v+" ft" : "‚Äî"
    }
  </div>
`;

    tideBox.appendChild(summary);

j.predictions.forEach(t=>{

  const row = document.createElement("div");
  row.className="tide-row";

  const tideTime = new Date(t.t.replace(" ","T"));
  const isFuture = tideTime > now;

  // Highlight next tide, dim past tides
  if(isFuture && !row.classList.contains("nextTide")){
    row.style.fontWeight="700";
    row.style.color="#38bdf8";
  }else if(!isFuture){
    row.style.opacity=".4";
  }

  row.innerHTML = `
    <span class="label">${t.type==="H"?"High Tide":"Low Tide"} ‚Äì ${t.t.slice(11,16)}</span>
    <span class="value">${t.v} ft</span>
  `;

  tideBox.appendChild(row);

});

  }catch(e){
    console.error(e);
    tideBox.innerHTML="Tide data unavailable";
  }

}

stateSelect.onchange = ()=>{

  citySelect.innerHTML = '<option value="">Select City</option>';

if(stateSelect.value==="OR"){

  citySelect.innerHTML += '<option value="9439040">Astoria, OR</option>';
  citySelect.innerHTML += '<option value="9432373">Bandon, OR</option>';
  citySelect.innerHTML += '<option value="9432373">Barview, OR</option>';
  citySelect.innerHTML += '<option value="9435385">Beverly Beach, OR</option>';
  citySelect.innerHTML += '<option value="9430104">Brookings, OR</option>';
  citySelect.innerHTML += '<option value="9438478">Cannon Beach, OR</option>';
  citySelect.innerHTML += '<option value="9432780">Coos Bay, OR</option>';
  citySelect.innerHTML += '<option value="9435827">Depoe Bay, OR</option>';
  citySelect.innerHTML += '<option value="9435827">Florence, OR</option>';
  citySelect.innerHTML += '<option value="9437540">Garibaldi, OR</option>';
  citySelect.innerHTML += '<option value="9430104">Gold Beach, OR</option>';
  citySelect.innerHTML += '<option value="9435827">Lincoln City, OR</option>';
  citySelect.innerHTML += '<option value="9438478">Manzanita, OR</option>';
  citySelect.innerHTML += '<option value="9438478">Nehalem, OR</option>';
  citySelect.innerHTML += '<option value="9435385">Newport, OR</option>';
  citySelect.innerHTML += '<option value="9432780">North Bend, OR</option>';
  citySelect.innerHTML += '<option value="9438478">Pacific City, OR</option>';
  citySelect.innerHTML += '<option value="9431647">Port Orford, OR</option>';
  citySelect.innerHTML += '<option value="9432780">Reedsport, OR</option>';
  citySelect.innerHTML += '<option value="9438478">Seaside, OR</option>';
  citySelect.innerHTML += '<option value="9437331">Tillamook, OR</option>';
  citySelect.innerHTML += '<option value="9438478">Tolovana Park, OR</option>';
  citySelect.innerHTML += '<option value="9435385">Waldport, OR</option>';
  citySelect.innerHTML += '<option value="9432780">Winchester Bay, OR</option>';
  citySelect.innerHTML += '<option value="9435385">Yachats, OR</option>';

}

  citySelect.disabled = !stateSelect.value;
};
  citySelect.onchange = loadTides;
</script>


</body>
</html>
