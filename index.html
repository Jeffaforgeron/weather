<!DOCTYPE html>
<html lang="en">
<head>
  
<meta charset="UTF-8">
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-DNM3ESS2FJ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());


  gtag('config', 'G-DNM3ESS2FJ');
</script>

  
<title>Forgeron Weather Dashboard</title>

<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

<style>
  /* ===== AMBIENT DAY / NIGHT BACKGROUND ===== */

body{
  position:relative;
  overflow-x:hidden;
}

/* base space layer */
body::before{
  content:"";
  position:fixed;
  inset:0;
  z-index:-2;
  transition:all 2s ease;

  background:
    radial-gradient(circle at 20% 10%, rgba(56,189,248,.12), transparent 40%),
    radial-gradient(circle at 80% 30%, rgba(74,222,128,.08), transparent 45%),
    linear-gradient(#020617,#020617);
}

/* DAY MODE */
body.day::before{
  background:
    radial-gradient(circle at 50% -10%, rgba(250,204,21,.28), transparent 45%),
    radial-gradient(circle at 20% 20%, rgba(56,189,248,.18), transparent 40%),
    radial-gradient(circle at 80% 40%, rgba(74,222,128,.16), transparent 45%),
    linear-gradient(#020617,#020617);
}



/* NIGHT MODE */
body.night::before{
  background:
    radial-gradient(circle at 30% 20%, rgba(147,51,234,.28), transparent 40%),
    radial-gradient(circle at 70% 40%, rgba(56,189,248,.18), transparent 45%),
    linear-gradient(#020617,#020617);
}


/* subtle stars */
body.night::after{
  content:"";
  position:fixed;
  inset:0;
  z-index:-1;
  background-image:
    radial-gradient(1px 1px at 20% 30%, rgba(255,255,255,.4) 50%, transparent 51%),
    radial-gradient(1px 1px at 70% 60%, rgba(255,255,255,.3) 50%, transparent 51%),
    radial-gradient(1px 1px at 40% 80%, rgba(255,255,255,.25) 50%, transparent 51%),
    radial-gradient(1px 1px at 85% 15%, rgba(255,255,255,.35) 50%, transparent 51%);
  opacity:.65;
}

body {
  font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
  margin: 20px;
  background: #1f2933;
  color: #f9fafb;
  position: relative;
}
  /* ===== DESKTOP DASHBOARD COLUMNS ===== */
.column {
  display: flex;
  flex-direction: column;
  gap: 16px;
  flex: 1 1 480px;
}
/* ===== FORCE TWO-COLUMN DESKTOP LAYOUT ===== */
@media (min-width: 769px) {
  .top-row {
    flex-wrap: nowrap;
  }
}
/* ===== DESKTOP PANEL ORDER ===== */
.top-row .panel:nth-child(1){ order:2; } /* Satellite */
.top-row .panel:nth-child(2){ order:1; } /* Radar */
.top-row .panel:nth-child(3){ order:3; } /* Current */
.top-row .panel:nth-child(4){ order:4; } /* Forecast */




/* ================= CITY TEMP TICKER ================= */
.city-list {
  position: absolute;
  top: 10px;
  left: 10px;

  width: 240px;              /* match clocks scale */
  height: 28px;

  background: rgba(0,0,0,0.6);
  color: #e5e7eb;

  font-size: 11px;
  padding: 4px 6px;
  border-radius: 7px;

  z-index: 10;
  overflow: hidden;

  box-shadow: 0 0 8px rgba(56,189,248,.25);
  backdrop-filter: blur(12px);
  border: 1px solid rgba(56,189,248,.25);

  box-shadow:
    inset 0 0 10px rgba(56,189,248,.15),
    0 0 12px rgba(56,189,248,.25);

  letter-spacing:.3px;

}


.city-track {
  display: inline-flex;
  white-space: nowrap;
  animation: cityScroll 37s linear infinite;
}

.city-item {
  display: inline-flex;
  align-items: center;
  gap: 4px;
  padding: 0 10px;
    opacity:.85;
}


.city-temp {
  font-weight:700;
  color:#38bdf8;
  text-shadow:0 0 6px rgba(56,189,248,.6);
}


@keyframes cityScroll {
  from { transform: translateX(0); }
  to { transform: translateX(-50%); }
}

/* ================= CLOCKS ================= */
.time-bar {
  position: absolute;
  top: 10px;
  right: 10px;
  display: flex;
  gap: 5px;
  z-index: 10;
  font-family: ui-monospace, monospace;
}

.time-pill {
  background: rgba(0,0,0,0.6);
  color: #e5e7eb;
  padding: 4px 6px;
  border-radius: 7px;
  font-size: 10px;
  letter-spacing: 0.6px;
  min-width: 48px;
  text-align: center;
}

.time-pill span {
  display: block;
  font-size: 8px;
  opacity: 0.65;
  margin-bottom: 1px;
}

/* ================= LAYOUT ================= */
h1 {
  text-align: center;
  margin-top: 60px;
  margin-bottom: 6px;
}

.subtitle {
  text-align: center;
  color: #9ca3af;
  margin-bottom: 26px;
}

.top-row {
  display: flex;
  gap: 16px;
  flex-wrap: wrap;
}

.panel {
  flex: 1 1 480px;
  background: #e5e7eb;
  border-radius: 10px;
  display: flex;
  flex-direction: column;
  color: #111;
}

.panel.full {
  flex: 1 1 100%;
  margin-top: 20px;
}

.panel-title {
  padding: 10px 12px;
  font-weight: 600;
  background: #dde1e6;
}

.image-box {
  height: 440px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: #dfe3e8;
}

.image-box img {
  max-width: 100%;
  max-height: 100%;
}

.controls {
  padding: 10px;
  background: #e9ebee;
  display: flex;
  gap: 8px;
  flex-wrap: wrap;
  font-size: 13px;
}

select { font-size: 13px; }
/* ===== MOBILE FIX: SAFE PHASE 1 OVERRIDES ===== */
@media (max-width: 768px) {

  body {
    margin: 10px;
  }
/* ===== MOBILE PANEL ORDER ===== */

.top-row .panel:nth-child(1){ order:4; } /* Satellite -> last */
.top-row .panel:nth-child(2){ order:1; } /* Radar -> first */
.top-row .panel:nth-child(3){ order:2; } /* Current Conditions */
.top-row .panel:nth-child(4){ order:3; } /* Forecast Tools */

/* Feels Like interaction styling */
#feelsToggle {
  cursor: pointer;
  opacity: .7;

  color:#9ca3af;

  text-shadow:
    0 0 6px rgba(56,189,248,.4),
    0 0 14px rgba(45,212,191,.25);

  animation: feelsPulse 2.6s ease-in-out infinite;

  transition: color .2s ease, opacity .2s ease, text-shadow .2s ease;
}


#feelsToggle:hover {
  color: #38bdf8;
  opacity: 1;
  text-decoration: underline;
}

#feelsToggle.active {
  color: #38bdf8;
  text-decoration: underline;
}

  /* Satellite dropdown mobile shrink */
@media (max-width:768px){
  #satRegion{
    max-width:110px;     /* tighter width */
    font-size:11px;     /* slightly smaller text */
    padding:2px 4px;    /* less padding */
  }
}

  
  /* Move ticker + clocks into normal flow */
  .city-list {
  display: none !important;
}


  .time-bar {
    position: static;
    justify-content: center;
    margin-bottom: 10px;
  }

  /* Reduce header size */
  h1 {
    margin-top: 10px;
    font-size: 22px;
  }

  .subtitle {
    font-size: 13px;
    margin-bottom: 16px;
  }

  /* Stack Satellite + Radar */
  .top-row {
    flex-direction: column;
  }

  .panel {
    flex: 1 1 100%;
  }

  /* Make images fit phone screens */
  .image-box {
    height: auto;
    min-height: 220px;
    max-height: 60vh;
  }

  /* Make controls easier to tap */
  .controls {
    font-size: 14px;
    gap: 10px;
  }

  select {
    font-size: 14px;
    padding: 4px;
  }
}
/* ===== DESKTOP 2x2 DASHBOARD GRID ===== */
@media (min-width: 769px) {
  .top-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 16px;
  }

  .panel {
    width: 100%;
  }
}
/* ===== CLEAN FOOTER + SOCIAL ICONS ===== */

.footer {
  margin-top: 32px;
  padding-bottom: 20px;
  background: transparent;
  display: flex;
  justify-content: center;
}

.social-bar {
  display: flex;
  gap: 18px;
  padding: 10px 14px;
  background: #0b1220;
  border-radius: 10px;
}

.social-bar a {
  width: 22px;
  height: 22px;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  font-family: ui-monospace, system-ui, sans-serif;
  font-size: 13px;
  font-weight: 600;
  text-decoration: none;
  color: #9ca3af;
  border: 1px solid rgba(255,255,255,0.15);
  border-radius: 6px;
  transition: color 0.2s ease, border-color 0.2s ease, transform 0.2s ease;
}

.social-bar a:hover {
  color: #38bdf8;
  border-color: #38bdf8;
  transform: translateY(-2px);
}

/* ===== FORECAST TV (sleek) ===== */
.forecast-tv {
  padding: 6px 12px 12px 12px; /* tighter top */
  display: flex;
  flex-direction: column;
  gap: 10px;
  background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.03));
  border-radius: 8px;
  min-height: auto;          /* REMOVE forced height */
  color: var(--text-primary, #e5e7eb);
}


.forecast-header {
  display:flex;
  align-items:center;
  gap:12px;
  justify-content: space-between;
  color: var(--text-secondary,#cbd5e1);
  font-size:13px;
}

.forecast-header .city {
  font-weight:700;
  font-size:14px;
  color: var(--text-primary,#f1f5f9);
}

.refresh {
  cursor:pointer;
  opacity:0.7;
  padding:6px;
  border-radius:6px;
  transition: all .15s ease;
}
.refresh:hover { color: #38bdf8; transform: translateY(-2px); opacity:1; }

.forecast-grid {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  gap: 8px;
  width: 100%;
}

/* responsive: stack on small screens */
@media (max-width: 768px) {
  .forecast-grid { grid-template-columns: repeat(2, 1fr); }
}

/* forecast card */
.fc-card {
  background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  border: 1px solid rgba(255,255,255,0.04);
  border-radius: 8px;
  padding: 8px;
  display:flex;
  flex-direction: column;
  gap:6px;
  align-items:center;
  justify-content:space-between;
  min-height:110px;
  transition: transform .18s ease, box-shadow .18s ease;
}
.fc-card:hover {
  transform: translateY(-6px);
  box-shadow: 0 10px 30px rgba(2,6,23,0.45);
}

.fc-day {
  font-weight:700;
  font-size:13px;
  color: #f1f5f9;
  text-align:center;
}

.fc-icon {
  width:64px;
  height:64px;
  background: rgba(255,255,255,0.03);
  border-radius:8px;
  display:flex;
  align-items:center;
  justify-content:center;
  overflow:hidden;
}

.fc-icon img { width:100%; height:100%; object-fit:contain; filter: drop-shadow(0 2px 6px rgba(0,0,0,0.6)); }

.fc-temp {
  font-weight:800;
  font-size:16px;
  color: #fff;
  display:flex;
  gap:8px;
  align-items:center;
}

.fc-temp .hi { color: #ffd166; }  /* warm */
.fc-temp .lo { color: #9ad1ff; }  /* cool */

.fc-desc {
  font-size:11px;
  color: var(--text-secondary,#cbd5e1);
  text-align:center;
  line-height:1.1;
}

/* loader */
.loader {
  text-align:center;
  width:100%;
  color:var(--text-secondary,#9ca3af);
  padding:18px 0;
}

/* timestamp footer */
.forecast-footer{
  display:flex;
  justify-content:flex-end;
  padding:4px 6px;
}

.forecast-footer .ts{
  font-size:11px;
  color:var(--text-secondary,#9ca3af);
  white-space:nowrap;
}

@media(max-width:768px){
  .forecast-footer{
    justify-content:center;
  }
}

/* ===== FORECAST READABILITY BOOST ===== */

/* Darken card background */
.fc-card {
  background: #0b1220;
  border: 1px solid rgba(255,255,255,0.08);
}
.fc-card.active{
  outline:2px solid #38bdf8;
  box-shadow:0 0 20px rgba(56,189,248,.6);
}

/* Make day labels brighter */
.fc-day {
  color: #ffffff;
}

/* Stronger temps */
.fc-temp {
  color: #ffffff;
}

.fc-temp .hi {
  color: #facc15; /* warm yellow */
}

.fc-temp .lo {
  color: #60a5fa; /* cool blue */
}

/* Description text clearer */
.fc-desc {
  color: #cbd5e1;
}

/* Header text */
.forecast-header .city {
  color: #38bdf8;      /* dashboard accent blue */
  font-weight: 800;
  letter-spacing: 0.3px;
}

}

.forecast-header .meta {
  color: #9ca3af;
}

/* Icon container darker */
.fc-icon {
  background: #020617;
}

/* Forecast header darker, more subtle */
.forecast-header .city,
.forecast-header .meta {
  color: #9ca3af;   /* dark gray */
  font-weight: 600;
}
/* Forecast city dropdown styling */
#forecastCitySelect {
  background: #020617;
  color: #9ca3af;
  border: 1px solid rgba(255,255,255,0.1);
  border-radius: 6px;
  padding: 4px 6px;
  font-size: 12px;
}
/* ===== CURRENT CONDITIONS PRO CARD ===== */

.cc-header{
  display:flex;
  justify-content:space-between;
  margin-bottom:8px;
}

.cc-city{
  font-weight:700;
  color:#e5e7eb;
}

.cc-updated{
  font-size:11px;
  color:#9ca3af;
}

.cc-main{
  display:grid;
  grid-template-columns:2fr 1fr;
  gap:14px;
}

.cc-temp{
  font-size:56px;
  font-weight:900;
  color:#fff;
  animation:pulse 2.5s infinite;
}

.cc-feels{
  color:#9ca3af;
  margin-bottom:6px;
}

.cc-left canvas{
  width:100%;
}

.cc-right{
  display:flex;
  flex-direction:column;
  gap:6px;
  font-size:13px;
  color:#cbd5e1;
}

@keyframes pulse{
  0%{opacity:1}
  50%{opacity:.65}
  100%{opacity:1}
}
/* ===== CURRENT CONDITIONS PRO UI ===== */

#ccCityWrap{
  background: radial-gradient(circle at top,#0f172a,#020617);
  border-radius:10px;
  color:#e5e7eb;
}

.cc-main{
  grid-template-columns:1.5fr 1fr;
}

.cc-temp{
  font-size:64px;
  background:linear-gradient(90deg,#38bdf8,#facc15);
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
}

.cc-left{
  display:flex;
  flex-direction:column;
  gap:6px;
}

#ccChart{
  margin-top:8px;
}

.cc-right{
  background:#020617;
  border-radius:8px;
  padding:10px;
}

.cc-right div{
  background:#0b1220;
  padding:6px 8px;
  border-radius:6px;
  font-size:12px;
}

.cc-header{
  margin-bottom:10px;
}

.cc-city{
  font-size:15px;
  font-weight:800;
  letter-spacing:.4px;
}

.cc-updated{
  opacity:.6;
}

/* Glow chart */
canvas{
  filter:drop-shadow(0 0 6px rgba(56,189,248,.6));
}
/* ===== SPACE NEON CURRENT CONDITIONS ===== */

#ccCityWrap{
  background:
    radial-gradient(circle at 20% 10%, #1e293b 0%, transparent 40%),
    radial-gradient(circle at 80% 30%, #0ea5e9 0%, transparent 45%),
    radial-gradient(circle at 50% 80%, #9333ea 0%, transparent 50%),
    linear-gradient(#020617,#020617);
}

.cc-left{
  padding-right:6px;
}



.cc-right div{
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.cc-right div span{
  color:#38bdf8;
  font-weight:600;
}

/* Axis labels */
.chart-title{
  font-size:12px;
  color:#9ca3af;
  margin-bottom:6px;
  letter-spacing:.4px;
  text-align:left;
}


/* Neon pulse */
.cc-temp{
  text-shadow:0 0 18px rgba(56,189,248,.6);
}

/* softer chart */
canvas{
  filter:drop-shadow(0 0 10px rgba(56,189,248,.7));
}
/* ===== MOBILE PANEL ORDER ===== */
.top-row .panel:nth-child(1){ order:4; } /* Satellite */
.top-row .panel:nth-child(2){ order:3; } /* Radar */
.top-row .panel:nth-child(3){ order:1; } /* Current */
.top-row .panel:nth-child(4){ order:2; } /* Forecast */
/* ===== FORCE CURRENT CONDITIONS TO FILL PANEL HEIGHT ===== */

#ccCityWrap,
#ccMapWrap {
  flex: 1;
  display: flex;
  flex-direction: column;
}

.cc-main {
  flex: 1;
}

.cc-left,
.cc-right {
  height: 100%;
}
/* Make Current Conditions chart fill available height */

#ccChart{
  flex:1;
  width:100% !important;
  min-height:220px;
}

.cc-left{
  flex:1;
}
/* ================= GLOBAL DASHBOARD POLISH ================= */

/* Panels become dark glass */
.panel{
  background:#020617 !important;
  border:1px solid rgba(255,255,255,.06);
  box-shadow:0 10px 40px rgba(0,0,0,.6);
}

/* Titles */
.panel-title{
  background:transparent;
  color:#9ca3af;
  letter-spacing:.4px;
  border-bottom:1px solid rgba(255,255,255,.05);
}

/* Subtle floating effect */
.panel:hover{
  transform:translateY(-2px);
  transition:.25s ease;
}

/* Image boxes darker */
.image-box{
  background:#020617;
}

/* Controls glass */
.controls{
  background:#020617;
  border-top:1px solid rgba(255,255,255,.05);
}

/* Dropdowns unified dark style */
select{
  background:#020617;
  color:#9ca3af;
  border:1px solid rgba(255,255,255,.12);
  border-radius:6px;
}

/* Forecast cards glow */
.fc-card{
  box-shadow:0 0 14px rgba(56,189,248,.15);
}
/* ===== WEBCAM UI ===== */

.webcam-strip{
  display:none;
  gap:10px;
  overflow-x:auto;
  padding:10px;
  margin-top:8px;
  width:100%;
  max-width:100%;
flex-wrap:nowrap;
}

.webcam-strip.active{
  display:flex;
}

.webcam-card{
  min-width:180px;
  background:#020617;
  border-radius:10px;
  overflow:hidden;
  box-shadow:0 0 14px rgba(56,189,248,.25);
}

.webcam-card img{
  width:100%;
  display:block;
}

.webcam-label{
  padding:6px;
  font-size:11px;
  text-align:center;
  color:#9ca3af;
}

/* Mobile trigger card */
.webcam-trigger{
  cursor:pointer;
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:700;
  color:#38bdf8;
}

/* Hide trigger on desktop */
@media(min-width:769px){
  .webcam-trigger{display:none;}
}

/* Forecast hover neon */
.fc-card:hover{
  box-shadow:0 0 24px rgba(56,189,248,.35);
}

/* Ticker glass */
.city-list{
  backdrop-filter:blur(10px);
}

/* Clock glow */
.time-pill{
  box-shadow:0 0 8px rgba(56,189,248,.25);
}

/* Social bar subtle neon */
.social-bar{
  box-shadow:0 0 18px rgba(56,189,248,.25);
}

/* Links neon hover */
a:hover{
  text-shadow:0 0 10px rgba(56,189,248,.8);
}

/* Forecast grid breathing animation */
.fc-card{
  animation:float 6s ease-in-out infinite;
}

@keyframes float{
  0%{transform:translateY(0)}
  50%{transform:translateY(-4px)}
  100%{transform:translateY(0)}
}

/* Slight chart glow everywhere */
canvas{
  filter:drop-shadow(0 0 12px rgba(56,189,248,.6));
}

/* Headline */
h1{
  font-weight:900;
  letter-spacing:.8px;
  text-align:center;

  background: linear-gradient(
    90deg,
    #22d3ee,
    #2dd4bf,
    #4ade80,
    #2dd4bf,
    #22d3ee
  );
  background-size:300% 300%;
  animation: titleGlow 12s ease infinite, mintPulse 3s ease-in-out infinite;

  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;

  text-shadow:
  0 0 4px rgba(34,211,238,.45),
  0 0 10px rgba(45,212,191,.3),
  0 0 22px rgba(74,222,128,.2);

}




/* subtle color drift */
@keyframes mintPulse{
  0%{
    text-shadow:
      0 0 6px rgba(34,211,238,.5),
      0 0 16px rgba(45,212,191,.35),
      0 0 28px rgba(74,222,128,.2);
  }

  50%{
    text-shadow:
      0 0 10px rgba(34,211,238,.7),
      0 0 22px rgba(45,212,191,.5),
      0 0 36px rgba(74,222,128,.3);
  }

  100%{
    text-shadow:
      0 0 6px rgba(34,211,238,.5),
      0 0 16px rgba(45,212,191,.35),
      0 0 28px rgba(74,222,128,.2);
  }
}





/* ===== HOURLY FORECAST ===== */

#hourlyWrap{
  display:flex;
  gap:8px;
  padding:10px;
  margin-top:8px;

  width:100%;
  max-width:100%;
  box-sizing:border-box;

  overflow-x:auto;
  overflow-y:hidden;

  background:#020617;
  border-radius:8px;

  min-height:110px;
}






/* inner scrolling rail */
#hourlyWrap::-webkit-scrollbar{
  display:none;
}

.hour-scroll{
  display:flex;
  gap:8px;
  overflow-x:auto;
  scroll-behavior:smooth;
  width:100%;
}


.hour-card{
  min-width:70px;
  background:#020617;
  border-radius:8px;
  padding:6px;
  text-align:center;
  box-shadow:0 0 12px rgba(56,189,248,.25);
  color:#e5e7eb;
  font-size:11px;
}

.hour-card img{
  width:32px;
}

.hour-temp{
  font-weight:700;
  margin-top:4px;
}
.hour-arrow{
  position:absolute;
  top:50%;
  transform:translateY(-50%);
  width:26px;
  height:60px;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:22px;
  color:#38bdf8;
  background:rgba(2,6,23,.8);
  cursor:pointer;
  z-index:5;
  opacity:.6;
}

.hour-arrow:hover{opacity:1}

.hour-arrow.left{left:0}
.hour-arrow.right{right:0}

/* ===== MOBILE FORECAST HARD OVERRIDE ===== */
@media (max-width:768px){

  #forecastPanel,
  .forecast-tv{
    overflow:hidden !important;
  }

  #hourlyWrap{
    display:flex !important;
    width:100% !important;
    max-width:100% !important;
    overflow-x:auto !important;
    overflow-y:hidden !important;
    box-sizing:border-box !important;
  }

  #hourRail{
    display:flex !important;
    gap:10px !important;
    min-width:max-content !important;
  }

  .hour-card{
    min-width:70px !important;
    flex-shrink:0 !important;
  }

  body{
    overflow-x:hidden !important;
  }

  .top-row{
    max-width:100% !important;
  }

}
/* ================= MOBILE FORECAST FULL LOCKDOWN ================= */
@media (max-width:768px){

  html, body{
    max-width:100vw !important;
    overflow-x:hidden !important;
  }

  .top-row,
  .panel,
  #forecastPanel,
  .forecast-tv{
    max-width:100% !important;
    overflow:hidden !important;
  }

  #forecastGrid{
    max-width:100% !important;
  }

  /* Hourly container */
  #hourlyWrap{
    display:flex !important;
    position:relative !important;
    width:100% !important;
    max-width:100% !important;
    overflow:hidden !important;
    box-sizing:border-box !important;
  }

  /* Scrolling rail */
  #hourRail{
    display:flex !important;
    gap:10px !important;
    width:auto !important;
    max-width:none !important;
    overflow-x:auto !important;
    overflow-y:hidden !important;
    -webkit-overflow-scrolling:touch;
  }

  /* Hour cards */
  .hour-card{
    min-width:72px !important;
    flex-shrink:0 !important;
  }

  /* Kill any accidental wide elements */
  canvas, img{
    max-width:100% !important;
  }

}
/* ===== MOBILE HOURLY SCROLL FIX ===== */
@media (max-width:768px){

  #hourlyWrap{
    overflow:hidden !important;
    touch-action:pan-x !important;
  }

  #hourRail{
    overflow-x:auto !important;
    overflow-y:hidden !important;
    display:flex !important;
    width:max-content !important;
    min-width:100% !important;
    -webkit-overflow-scrolling:touch !important;
    padding-right:20px;
  }

  .hour-card{
    flex:0 0 72px !important;
  }

}
/* ===== MOBILE CURRENT CONDITIONS LAYOUT FIX ===== */
@media (max-width:768px){

  /* Stack chart above stats */
  .cc-main{
    grid-template-columns:1fr !important;
  }

  /* Make chart full width */
  .cc-left{
    width:100%;
  }

  /* Push stats below chart */
  .cc-right{
    margin-top:10px;
  }

  /* Give chart breathing room */
  #ccChart{
    min-height:240px;
  }

}
/* Current Conditions city hint */
#ccHint{
  color:#38bdf8;
  font-size:12px;
  font-weight:600;
  animation:ccHintPulse 1.8s ease-in-out infinite;
  margin-left:auto;
  margin-right:6px;
  white-space: nowrap;          /* prevent stacking */
}

/* Mobile polish */
@media (max-width:768px){
  #ccHint{
    margin-left:8px;
    margin-top:4px;
    display:block;
    text-align:right;
    white-space:normal;      /* allow wrap */
    max-width:100%;
    line-height:1.2;
  }
}



#forecastHint{
  color:#38bdf8;
  font-size:12px;
  font-weight:600;
  animation:ccHintPulse 1.8s ease-in-out infinite;
  white-space:nowrap;
}

  #forecastHint{
  color:#38bdf8;
  font-size:12px;
  font-weight:600;
  animation:ccHintPulse 1.8s ease-in-out infinite;
  white-space:nowrap;
}

/* === Satellite hint (click image to animate) === */
#satHint{
  color:#38bdf8;
  font-size:12px;
  font-weight:600;
  margin-left:6px;
  animation:ccHintPulse 1.8s ease-in-out infinite;
  white-space:nowrap;
  opacity:.8;
}

/* Mobile polish */
@media (max-width:768px){
  #satHint{
    display:block;
    margin-left:0;
    margin-top:4px;
  }
}

  
@keyframes ccHintPulse{
  0%{opacity:.4}
  50%{opacity:1}
  100%{opacity:.4}
}
/* FORCE FORECAST TOOLS TO NOT HAVE EMPTY TOP SPACE */

#forecastPanel {
  align-items: stretch;
}

.forecast-tv {
  flex: 0 !important;
}

#forecastGrid {
  margin-top: 0 !important;
}

#hourlyHint {
  margin-top: 0 !important;
}
/* PULL FORECAST CONTENT UPWARD */

.forecast-tv{
  justify-content:flex-start !important;
}

#forecastGrid{
  margin-top:4px !important;
}

#hourlyHint{
  margin-top:2px !important;
}
 /* === FORCE 7-DAY FORECAST TO TOP OF PANEL === */

.forecast-tv{
  min-height:unset !important;
  padding-top:4px !important;
  justify-content:flex-start !important;
}

.forecast-header{
  margin-top:0 !important;
}

#hourlyHint{
  margin-top:4px !important;
}

#forecastGrid{
  margin-top:0 !important;
}

#forecastPanel{
  display:flex;
  flex-direction:column;
}
/* ==== HARD LOCK hourly forecast inside Forecast Tools panel ==== */

#forecastPanel {
  position: relative;
  overflow: hidden;   /* keeps hourly inside this panel only */
}

.forecast-tv {
  width: 100%;
  max-width: 100%;
  overflow: hidden;
}

#hourlyWrap {
  width: 100%;
  max-width: 100%;
  box-sizing: border-box;
  overflow-x: auto;
  overflow-y: hidden;
}

#hourRail {
  display: flex;
  width: max-content;
  max-width: none;
}

/* Prevent hourly cards from forcing page wider */
.hour-card {
  flex-shrink: 0;
}

/* Kill any accidental horizontal page stretch */
html, body {
  overflow-x: hidden;
}

/* ==== SLICK HOURLY SCROLLBAR (Robinhood / Kalshi vibe) ==== */

/* Chrome / Edge / Safari */
#hourlyWrap::-webkit-scrollbar {
  height: 6px;
}

#hourlyWrap::-webkit-scrollbar-track {
  background: rgba(2,6,23,.9);
  border-radius: 10px;
}

#hourlyWrap::-webkit-scrollbar-thumb {
  background: linear-gradient(90deg,#38bdf8,#60a5fa);
  border-radius: 10px;
  box-shadow: 0 0 8px rgba(56,189,248,.6);
}

#hourlyWrap::-webkit-scrollbar-thumb:hover {
  background: linear-gradient(90deg,#60a5fa,#38bdf8);
  box-shadow: 0 0 12px rgba(56,189,248,.9);
}

/* Firefox */
#hourlyWrap {
  scrollbar-width: thin;
  scrollbar-color: #38bdf8 #020617;
}
/* ==== HARD LOCK TICKER SIZE (DESKTOP) ==== */

.city-list{
  position:absolute !important;
  top:10px !important;
  left:10px !important;

  width:240px !important;
  max-width:240px !important;
  height:28px !important;

  padding:14px 6px 4px 6px !important;
  border-radius:7px !important;

  overflow:hidden !important;
}

/* constrain the scrolling rail */
.city-track{
  display:flex !important;
  width:max-content !important;
}

/* tighter items */
.city-item{
  padding:0 10px !important;
  gap:4px !important;
}

/* mobile still full width */
@media(max-width:768px){
  .city-list{
    position:static !important;
    width:100% !important;
    max-width:100% !important;
    height:auto !important;
  }
}

/* ===== TICKER LABEL FINAL FIX ===== */
.ticker-label{
  position:absolute;
  top:-14px;               /* lift above ticker */
  left:50%;
  transform:translateX(-50%);

  font-size:9px;
  text-transform:uppercase;
  letter-spacing:.7px;
  color:#9ca3af;
  opacity:.7;

  white-space:nowrap;
  pointer-events:none;
}

/* Mobile: keep label visible when ticker becomes static */
@media(max-width:768px){
  .ticker-label{
    position:relative;
    top:0;
    left:auto;
    transform:none;
    display:block;
    text-align:center;
    margin-bottom:4px;
  }
}


  
/* ===== TV-STYLE 7 DAY FORECAST HEIGHT ===== */
@media (min-width:769px){

  .forecast-grid{
    grid-auto-rows: 1fr;
  }

  .fc-card{
    min-height:180px;
    justify-content:space-between;
  }

}
/* Subtle broadcast font bump */
@media (min-width:769px){
  .fc-day{ font-size:14px; }
  .fc-temp{ font-size:18px; }
  .fc-desc{ font-size:12px; }
}

.fc-wind{
  font-size:11px;
  color:#9ca3af;
}
.fc-snow{
  font-size:11px;
  color:#60a5fa;
  text-align:center;
  line-height:1.1;
}

.hour-wind{
  font-size:10px;
  color:#9ca3af;
  margin-top:2px;
}

#ccRainDay span,
#ccRainMonth span{
  color:#38bdf8;
  font-weight:600;
}
/* Sun + UV footer in Current Conditions */

#ccSunUV{
  margin-top:auto;
  padding-top:10px;
  border-top:1px solid rgba(56,189,248,.25);
  display:grid;
  grid-template-columns:repeat(2,1fr);
  gap:8px;
  font-size:11px;
  color:#9ca3af;

  background: radial-gradient(circle at top,#0f172a,#020617);
  border-radius:8px;
  box-shadow:0 0 14px rgba(56,189,248,.25);
}


#ccSunUV div{
  background:#0b1220;
  border-radius:6px;
  padding:8px 6px;
  text-align:center;
  box-shadow:inset 0 0 8px rgba(56,189,248,.25);
}
  
#ccSunUV span{
  display:block;
  font-size:10px;
  opacity:.7;
}

#ccSunUV strong{
  display:block;
  margin-top:3px;
  color:#38bdf8;
  font-weight:800;
  font-size:12px;
  white-space:nowrap;
  text-shadow:0 0 8px rgba(56,189,248,.7);
}

.sun-icon{
  margin-right:4px;
  font-size:13px;
  filter: drop-shadow(0 0 6px rgba(250,204,21,.6));
}

/* Sunrise slightly warmer */
.sun-icon.rise{
  filter:
    drop-shadow(0 0 6px rgba(250,204,21,.8))
    drop-shadow(0 0 12px rgba(251,146,60,.4));
}

/* Sunset slightly softer */
.sun-icon.set{
  filter:
    drop-shadow(0 0 6px rgba(251,146,60,.7))
    drop-shadow(0 0 10px rgba(239,68,68,.3));
}

/* ===== MOBILE FIX: CURRENT CONDITIONS DROPDOWNS FULL WIDTH ===== */
@media (max-width:768px){

  /* Allow header row to wrap */
  .panel-title{
    flex-wrap: wrap;
    gap: 6px;
  }

  /* Force state + city selects onto full rows */
  #currentStateSelect,
  #currentCitySelect{
    width:100%;
    max-width:100%;
  }
/* ===== MOBILE FIX: FORECAST TOOLS DROPDOWNS STACKED ===== */
#forecastStateSelect,
#forecastCitySelect{
  width:100%;
  max-width:100%;
}

  /* Push hint above dropdowns */
  #ccHint{
    width:100%;
    text-align:right;
    margin:0;
  }
}
/* Mobile only: change CC hint arrow to DOWN */
@media (max-width:768px){

  #ccHint{
    font-size:0;   /* hide original text */
  }

  #ccHint::before{
    content:"Select a city â†“";
    font-size:12px;
    color:#38bdf8;
    font-weight:600;
  }
}
/* Mobile: change arrow to DOWN for Current Conditions hint */
@media (max-width:768px){

  #ccHint{
    font-size:0;
    white-space:normal;
    max-width:100%;
    line-height:1.2;
    text-align:left;     /* ðŸ‘ˆ match Forecast Tools */
  }

  #ccHint::before{
    content:"Select a state, then city â†“";
    font-size:12px;
    color:#38bdf8;
    font-weight:600;
  }
}

 /* Mobile: change arrow to DOWN for Forecast Tools hint */
@media (max-width:768px){

  #forecastHint{
    font-size:0;
    white-space:normal;
    max-width:100%;
    line-height:1.2;
    text-align:right;
  }

  #forecastHint::before{
    content:"Select a state, then city â†“";
    font-size:12px;
    color:#38bdf8;
    font-weight:600;
  }
}

/* ===== FORECAST PANEL HEIGHT RESTORE (DESKTOP ONLY) ===== */
@media (min-width:769px){

  #forecastPanel{
    height:auto;
  }

  .forecast-tv{
    min-height:300px;
  }

}
/* ===== FORECAST TOOLS FORCE HEIGHT (DESKTOP SAFE) ===== */
@media (min-width:769px){
  .forecast-tv{
    min-height:420px !important;
  }
}
#hamburgerMenu{
  position:absolute;
  top:70px;
  right:20px;
  font-size:26px;
  cursor:pointer;
  z-index:99999;
  background:#020617;
  padding:6px 10px;
  border-radius:8px;

  /* CRITICAL: detach from layout transforms */
  transform:none !important;
}


#menuDropdown{
  display:none;
  position:absolute;
  right:0;
  margin-top:8px;
  background:#0b1220;
  border-radius:8px;
  min-width:140px;
}

#menuDropdown a{
  display:block;
  padding:10px;
  color:white;
  text-decoration:none;
}

#menuDropdown a:hover{
  background:#020617;
}

@media (max-width:768px){
  #hamburgerMenu{
    position:absolute;
    top:59px;
    right:16px;
    left:auto;
    transform:none !important;
    background:transparent;
  }
}

#ccConfidence{
  padding:4px 8px;
  border-radius:6px;
  background:#020617;
  box-shadow:0 0 10px rgba(56,189,248,.25);
}
</style>
</head>

<body>
<!-- MENU BUTTON -->
<div id="hamburgerMenu">
  â˜°
  <div id="menuDropdown">
    <a href="index.html">Dashboard</a>
    <a href="tides.html">Tides</a>
    <a href="webcams.html">Webcams</a>
  </div>
</div>


  




  
  
<!-- ===== CITY TEMP TICKER ===== -->
<div class="city-list">
  <div class="ticker-label">Current Temperatures</div>
<div class="city-track">

<div class="city-item" data-station="KNYC">New York <span class="city-temp">--</span></div>
<div class="city-item" data-station="KLAX">Los Angeles <span class="city-temp">--</span></div>
<div class="city-item" data-station="KORD">Chicago <span class="city-temp">--</span></div>
<div class="city-item" data-station="KIAH">Houston <span class="city-temp">--</span></div>
<div class="city-item" data-station="KPHX">Phoenix <span class="city-temp">--</span></div>
<div class="city-item" data-station="KPHL">Philadelphia <span class="city-temp">--</span></div>
<div class="city-item" data-station="KSAT">San Antonio <span class="city-temp">--</span></div>
<div class="city-item" data-station="KSAN">San Diego <span class="city-temp">--</span></div>
<div class="city-item" data-station="KDAL">Dallas <span class="city-temp">--</span></div>
<div class="city-item" data-station="KAUS">Austin <span class="city-temp">--</span></div>
<div class="city-item" data-station="KSJC">San Jose <span class="city-temp">--</span></div>
<div class="city-item" data-station="KDFW">Fort Worth <span class="city-temp">--</span></div>
<div class="city-item" data-station="KSEA">Seattle <span class="city-temp">--</span></div>
<div class="city-item" data-station="KDEN">Denver <span class="city-temp">--</span></div>
<div class="city-item" data-station="KDCA">Washington DC <span class="city-temp">--</span></div>
<div class="city-item" data-station="KBOS">Boston <span class="city-temp">--</span></div>
<div class="city-item" data-station="KDET">Detroit <span class="city-temp">--</span></div>
<div class="city-item" data-station="KPDX">Portland <span class="city-temp">--</span></div>
<div class="city-item" data-station="KMEM">Memphis <span class="city-temp">--</span></div>
<div class="city-item" data-station="KBWI">Baltimore <span class="city-temp">--</span></div>
<div class="city-item" data-station="KMKE">Milwaukee <span class="city-temp">--</span></div>
<div class="city-item" data-station="KABQ">Albuquerque <span class="city-temp">--</span></div>
<div class="city-item" data-station="KTUS">Tucson <span class="city-temp">--</span></div>
<div class="city-item" data-station="KFLL">Fort Lauderdale <span class="city-temp">--</span></div>
<div class="city-item" data-station="KELP">El Paso <span class="city-temp">--</span></div>

<div class="city-item" data-station="KNYC">New York <span class="city-temp">--</span></div>
<div class="city-item" data-station="KLAX">Los Angeles <span class="city-temp">--</span></div>
<div class="city-item" data-station="KORD">Chicago <span class="city-temp">--</span></div>
<div class="city-item" data-station="KIAH">Houston <span class="city-temp">--</span></div>
<div class="city-item" data-station="KPHX">Phoenix <span class="city-temp">--</span></div>
<div class="city-item" data-station="KPHL">Philadelphia <span class="city-temp">--</span></div>
<div class="city-item" data-station="KSAT">San Antonio <span class="city-temp">--</span></div>
<div class="city-item" data-station="KSAN">San Diego <span class="city-temp">--</span></div>
<div class="city-item" data-station="KDAL">Dallas <span class="city-temp">--</span></div>
<div class="city-item" data-station="KAUS">Austin <span class="city-temp">--</span></div>
<div class="city-item" data-station="KSJC">San Jose <span class="city-temp">--</span></div>
<div class="city-item" data-station="KDFW">Fort Worth <span class="city-temp">--</span></div>
<div class="city-item" data-station="KSEA">Seattle <span class="city-temp">--</span></div>
<div class="city-item" data-station="KDEN">Denver <span class="city-temp">--</span></div>
<div class="city-item" data-station="KDCA">Washington DC <span class="city-temp">--</span></div>
<div class="city-item" data-station="KBOS">Boston <span class="city-temp">--</span></div>
<div class="city-item" data-station="KDET">Detroit <span class="city-temp">--</span></div>
<div class="city-item" data-station="KPDX">Portland <span class="city-temp">--</span></div>
<div class="city-item" data-station="KMEM">Memphis <span class="city-temp">--</span></div>
<div class="city-item" data-station="KBWI">Baltimore <span class="city-temp">--</span></div>
<div class="city-item" data-station="KMKE">Milwaukee <span class="city-temp">--</span></div>
<div class="city-item" data-station="KABQ">Albuquerque <span class="city-temp">--</span></div>
<div class="city-item" data-station="KTUS">Tucson <span class="city-temp">--</span></div>
<div class="city-item" data-station="KFLL">Fort Lauderdale <span class="city-temp">--</span></div>
<div class="city-item" data-station="KELP">El Paso <span class="city-temp">--</span></div>
  
</div>

</div>

<!-- ===== CLOCKS ===== -->
<div class="time-bar" id="timeBar"></div>

<h1>Forgeron Weather Dashboard</h1>

<div class="subtitle">Weather intelligence, simplified.</div>


<div class="top-row">
  <!-- SATELLITE -->
  <div class="panel">
 <div class="panel-title" style="display:flex;justify-content:space-between;align-items:center;">
<span>Satellite <span id="satHint">(click image to animate)</span></span>


  <select id="satRegion" onchange="updateSatellite()">
    <option value="gwas" selected>CONUS (G18)</option>
    <option value="pnw">Pacific Northwest (G18)</option>
    <option value="wus">West U.S. (G18)</option>
    <option value="psw">Southwest U.S. (G18)</option>
    <option value="tpw">Tropical Pacific (G18)</option>
    <option value="np">Northern Pacific (G18)</option>
    <option value="gwas">CONUS (G18)</option>
    <option value="eus">East U.S. (G19)</option>
    <option value="nr">Northern Rockies (G19)</option>
    <option value="sr">Southern Rockies (G19)</option>
    <option value="sp">Southern Plains (G19)</option>
    <option value="can">Canada & Northern U.S. (G19)</option>
    <option value="umv">Upper Mississippi Valley (G19)</option>
    <option value="smv">Lower Mississippi Valley (G19)</option>
    <option value="cgl">Great Lakes (G19)</option>
    <option value="ne">Northeast (G19)</option>
  </select>
</div>

    <a id="satLink" target="_blank">
      <div class="image-box">
        <img id="satImage"
             src="https://cdn.star.nesdis.noaa.gov/GOES18/ABI/SECTOR/pnw/GEOCOLOR/latest.jpg">
      </div>
    </a>
   
  </div>

  <!-- RADAR -->
  <div class="panel">
   <div class="panel-title" style="display:flex;justify-content:space-between;align-items:center;">
  <span>Live Radar</span>
    

  <div style="display:flex;gap:6px;">
    <select id="regionSelect"></select>
    <select id="stateSelect"></select>
    <select id="radarSelect"></select>
  </div>
</div>


    <div class="image-box">
      <img id="radarImage"
           src="https://radar.weather.gov/ridge/standard/PACNORTHWEST_loop.gif">
    </div>

    </div> <!-- CLOSE RADAR PANEL -->

<!-- CURRENT CONDITIONS -->
<div class="panel">

<div class="panel-title" style="display:flex;justify-content:space-between;align-items:center;">
  <span>Current Conditions <span id="feelsToggle" style="opacity:.6;margin-left:6px;cursor:pointer;">Feels Like</span></span>
  <span id="ccHint" style="margin-right:8px;">Select a state, then city â†’</span>

  <select id="currentStateSelect">
    <option value="">Select State</option>
  </select>

  <select id="currentCitySelect">
    <option value="">Select City</option>
  </select>
</div>

<!-- MAP MODE -->
<div id="ccMapWrap" class="image-box" style="padding:0;display:flex;">
  <img id="tempMapImage"
    src="https://data.mesonet.org/data/public/noaa/metar/maps/realtime/latest.tair.png"
    style="width:100%;height:auto;">
</div>

<!-- CITY MODE -->
<div id="ccCityWrap" style="display:none;padding:14px;">

  <div class="cc-header">
    <div id="ccConfidence" style="font-size:11px;color:#9ca3af;"></div>
    <div id="ccCity" class="cc-city"></div>
    <div id="ccUpdated" class="cc-updated"></div>
    <div id="ccConfidence" style="font-size:11px;color:#9ca3af;"></div>
  </div>

  <div class="cc-main">

    <div class="cc-left">
      <div id="ccTemp" class="cc-temp">â€”</div>
      <div id="ccFeels" class="cc-feels"></div>
      <div class="chart-title">Temperature â€“ Past 12 Hours</div>
      <canvas id="ccChart"></canvas>
    </div>

    <div class="cc-right">
      <div id="ccWx"></div>
      <div id="ccWind"></div>
      <div id="ccHum"></div>
      <div id="ccDew"></div>
      <div id="ccRainDay"></div>
      <div id="ccRainMonth"></div>

      <div id="ccSunUV">
        <div>
          <span>ðŸŒ… Sunrise</span>
          <strong id="ccSunrise">â€”</strong>
        </div>
        <div>
          <span>ðŸŒ‡ Sunset</span>
          <strong id="ccSunset">â€”</strong>
        </div>
      </div>

    </div>
  </div>
</div>

</div>


<!-- FORECAST TOOLS (7-day sleek TV style) -->
<div class="panel" id="forecastPanel">

 <div class="panel-title" style="display:flex;justify-content:space-between;align-items:center;">
  <span>Forecast Tools</span>

  <div style="display:flex;align-items:center;gap:8px;flex-wrap:wrap;">
  <span id="forecastHint">Select a state, then city â†’</span>

  <select id="forecastStateSelect">
    <option value="">Select State</option>
  </select>

  <select id="forecastCitySelect">
    <option value="">Select City</option>
  </select>
</div>

</div>


 <div class="forecast-tv">
  <div class="forecast-header">
  <div>
    <div id="forecastCityLabel" class="city">Select a city</div>
    <div class="meta">7-Day Outlook via NWS</div>
  </div>

  <div class="refresh" id="forecastRefreshBtn" title="Refresh now">âŸ³</div>
</div>






    <div id="forecastGrid" class="forecast-grid" aria-live="polite">
      <!-- Forecast cards injected here -->
      <div class="loader">Loadingâ€¦</div>
    </div>
<div id="hourlyWrap" style="display:flex;margin-top:10px;">


 

  <div id="hourRail" class="hour-scroll"></div>

  

</div>



    <div class="forecast-footer">
      <div id="forecastTimestamp" class="ts">Last updated: â€”</div>
    </div>
  </div>
</div>






<script>

const timeBar = document.getElementById("timeBar");
  
/* ===== CLOCKS ===== */
function updateTimes(){
  const n=new Date();
  const f=tz=>n.toLocaleTimeString("en-US",{
    timeZone:tz,hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:false
  });
  timeBar.innerHTML=`
    <div class="time-pill"><span>PT</span>${f("America/Los_Angeles")}</div>
    <div class="time-pill"><span>MT</span>${f("America/Denver")}</div>
    <div class="time-pill"><span>CT</span>${f("America/Chicago")}</div>
    <div class="time-pill"><span>ET</span>${f("America/New_York")}</div>
    <div class="time-pill"><span>UTC</span>${n.toISOString().slice(11,19)}Z</div>
  `;
}
setInterval(updateTimes,1000); updateTimes();
updateSatellite();

/* ===== SATELLITE ===== */
function updateSatellite(){
  const r=satRegion.value;
  const east=["eus","nr","sr","sp","can","umv","smv","cgl","ne"];
  if(east.includes(r)){
    satImage.src=`https://cdn.star.nesdis.noaa.gov/GOES19/ABI/SECTOR/${r}/GEOCOLOR/latest.jpg`;
    satLink.href=`https://www.star.nesdis.noaa.gov/goes/sector_band.php?sat=G19&sector=${r}&band=GEOCOLOR&length=24`;
  } else {
    satImage.src=r==="gwas"
      ? "https://cdn.star.nesdis.noaa.gov/GOES18/ABI/SECTOR/gwas/GEOCOLOR/1800x1080.jpg"
      : `https://cdn.star.nesdis.noaa.gov/GOES18/ABI/SECTOR/${r}/GEOCOLOR/latest.jpg`;
    satLink.href=`https://www.star.nesdis.noaa.gov/goes/sector_band.php?sat=G18&sector=${r}&band=GEOCOLOR&length=24`;
  }
}

/* ===== RADAR DATA (FULL, SAFE) ===== */
const radarRegions = {

"CONUS": { loop: "CONUS-LARGE" },

"Northwest": { loop:"PACNORTHWEST", states:{
  "WA":[["KATX","Seattle"],["KLGX","Langley Hill"],["KOTX","Spokane"]],
  "OR":[["KRTX","Portland"],["KMAX","Medford"],["KPDT","Pendleton"]],
  "ID":[["KCBX","Boise"]],
  "MT":[["KTFX","Great Falls"],["KMSX","Missoula"],["KGGW","Glasgow"]]
}},

"Southwest": { loop:"PACSOUTHWEST", states:{
  "CA":[["KMUX","San Jose"],["KDAX","Sacramento"],["KHNX","Hanford"],["KVTX","Los Angeles"],["KNKX","San Diego"]],
  "NV":[["KRGX","Reno"],["KLRX","Elko"]],
  "AZ":[["KIWA","Phoenix"],["KEMX","Tucson"],["KFSX","Flagstaff"],["KYUX","Yuma"]],
  "UT":[["KMTX","Salt Lake City"],["KICX","Cedar City"]],
  "NM":[["KABX","Albuquerque"],["KFDX","Cannon AFB"],["KHDX","Holloman AFB"]]
}},

"Northern Plains": { loop:"UPPERMISSVLY", states:{
  "ND":[["KBIS","Bismarck"],["KMBX","Minot"]],
  "SD":[["KFSD","Sioux Falls"],["KABR","Aberdeen"],["KUDX","Rapid City"]],
  "NE":[["KOAX","Omaha"],["KUEX","Hastings"],["KLNX","North Platte"]],
  "WY":[["KCYS","Cheyenne"],["KRIW","Riverton"]],
  "MT":[["KTFX","Great Falls"],["KMSX","Missoula"],["KGGW","Glasgow"]],
  "ID":[["KCBX","Boise"],["KSFX","Pocatello"]]
}},

"Southern Plains": { loop:"SOUTHPLAINS", states:{
  "TX":[["KFWS","Fort Worth"],["KHGX","Houston"],["KBRO","Brownsville"],["KAMA","Amarillo"],["KLBB","Lubbock"],["KEWX","Austin"],["KCRP","Corpus Christi"],["KMAF","Midland"]],
  "OK":[["KTLX","Oklahoma City"],["KINX","Tulsa"],["KFDR","Frederick"]],
  "KS":[["KICT","Wichita"],["KDDC","Dodge City"],["KTWX","Topeka"]],
  "CO":[["KFTG","Denver"],["KGJX","Grand Junction"],["KPUX","Pueblo"]]
}},

"Midwest": { loop:"CONUS-LARGE", states:{

  "MN":[["KMPX","Minneapolis"],["KDLH","Duluth"]],
  "IA":[["KDMX","Des Moines"],["KDVN","Davenport"]],
  "MO":[["KLSX","St. Louis"],["KEAX","Kansas City"],["KSGF","Springfield"]],
  "WI":[["KMKX","Milwaukee"],["KGRB","Green Bay"],["KARX","La Crosse"]],
  "IL":[["KLOT","Chicago"],["KILX","Lincoln"]],
  "IN":[["KIND","Indianapolis"],["KIWX","Northern Indiana"]],
  "MI":[["KDTX","Detroit"],["KGRR","Grand Rapids"],["KAPX","Gaylord"]],
  "OH":[["KCLE","Cleveland"],["KILN","Wilmington"]]
}},

"Southeast": { loop:"SOUTHEAST", states:{
  "FL":[["KJAX","Jacksonville"],["KTBW","Tampa"],["KMLB","Melbourne"],["KAMX","Miami"]],
  "GA":[["KFFC","Atlanta"]],
  "AL":[["KBMX","Birmingham"],["KHTX","Huntsville"]],
  "TN":[["KOHX","Nashville"],["KNQA","Memphis"]],
  "KY":[["KLVX","Louisville"],["KPAH","Paducah"]],
  "SC":[["KCAE","Columbia"]],
  "NC":[["KRAX","Raleigh"],["KLTX","Wilmington"]],
  "LA":[["KLCH","Lake Charles"],["KSHV","Shreveport"]],
  "MS":[["KDGX","Jackson"]]
}},

"Northeast": { loop:"NORTHEAST", states:{
  "NY":[["KBUF","Buffalo"],["KOKX","New York City"],["KENX","Albany"]],
  "PA":[["KPBZ","Pittsburgh"],["KCCX","State College"]],
  "MA":[["KBOX","Boston"]],
  "NJ":[["KDIX","Mount Holly"]],
  "CT":[["KBOX","Hartford"]],
  "VT":[["KBTV","Burlington"]],
  "NH":[["KGYX","Gray"]],
  "ME":[["KGYX","Gray"],["KCAR","Caribou"]],
  "MD":[["KLWX","Washington DC"]],
  "VA":[["KAKQ","Wakefield"],["KFCX","Blacksburg"]],
  "WV":[["KRLX","Charleston"]]
}}

};




function initRadar(){
  regionSelect.innerHTML="";
  Object.keys(radarRegions).forEach(r=>{
    regionSelect.innerHTML+=`<option value="${r}">${r}</option>`;
  });
  regionSelect.value="CONUS";

  handleRegionChange();
}

function handleRegionChange(){
  const r=radarRegions[regionSelect.value];
  if(regionSelect.value==="CONUS"){
    radarImage.src="https://radar.weather.gov/ridge/standard/CONUS-LARGE_loop.gif";
    stateSelect.innerHTML="";
    radarSelect.innerHTML="";
    return;
  }
  radarImage.src=`https://radar.weather.gov/ridge/standard/${r.loop}_loop.gif`;
  stateSelect.innerHTML=`<option value="">Select State</option>`;
  radarSelect.innerHTML="";
  Object.keys(r.states).forEach(s=>{
    stateSelect.innerHTML+=`<option value="${s}">${s}</option>`;
  });
}

function populateRadars(){
  radarSelect.innerHTML=`<option value="">Select City</option>`;
  const r=radarRegions[regionSelect.value];
  if(!stateSelect.value) return;
  r.states[stateSelect.value].forEach(site=>{
    radarSelect.innerHTML+=`<option value="${site[0]}">${site[1]}</option>`;
  });
}

function changeRadar(){
  if(!radarSelect.value) return;
  radarImage.src=`https://radar.weather.gov/ridge/standard/${radarSelect.value}_loop.gif`;
}

regionSelect.onchange=handleRegionChange;
stateSelect.onchange=populateRadars;
radarSelect.onchange=changeRadar;
initRadar();

/* ===== CITY TEMPS ===== */
async function updateCityTemps(){

  const items = [...document.querySelectorAll(".city-item")];

  await Promise.all(items.map(async item=>{

    const primary = item.dataset.station;
    const backup = item.dataset.backup;

    try{

      let r = await fetch(`https://api.weather.gov/stations/${primary}/observations/latest`);
      let j = await r.json();
      let c = j?.properties?.temperature?.value;

      // fallback if null
      if((c==null) && backup){
        r = await fetch(`https://api.weather.gov/stations/${backup}/observations/latest`);
        j = await r.json();
        c = j?.properties?.temperature?.value;
      }

      item.querySelector(".city-temp").textContent =
        c==null ? "--" : Math.round(c*9/5+32)+"Â°F";

    }catch{
      item.querySelector(".city-temp").textContent="--";
    }

  }));

}

updateCityTemps();
setInterval(updateCityTemps,300000);

  /* ===== AUTO REFRESH IMAGES (EVERY 5 MINUTES) ===== */
setInterval(() => {

  /* Current Conditions Temperature Map */
  const tempMap = document.getElementById("tempMapImage");
  if (tempMap) {
    tempMap.src =
      "https://data.mesonet.org/data/public/noaa/metar/maps/realtime/latest.tair.png?ts=" +
      Date.now();
  }

  /* Satellite */
  const sat = document.getElementById("satImage");
  if (sat) {
    sat.src = sat.src.split("?")[0] + "?ts=" + Date.now();
  }

  /* Radar */
  const radar = document.getElementById("radarImage");
  if (radar) {
    radar.src = radar.src.split("?")[0] + "?ts=" + Date.now();
  }

}, 300000); // 300000 ms = 5 minutes

/* ===== TEMP MAP HOVER / TAP TOGGLE ===== */
const airTempURL = "https://data.mesonet.org/data/public/noaa/metar/maps/realtime/latest.tair.png";
const feelsLikeURL = "https://data.mesonet.org/data/public/noaa/metar/maps/realtime/latest.tapp.png";

const tempMap = document.getElementById("tempMapImage");
const feelsToggle = document.getElementById("feelsToggle");

if (tempMap && feelsToggle) {

  // Desktop hover
  feelsToggle.addEventListener("mouseenter", () => {
    tempMap.src = feelsLikeURL + "?ts=" + Date.now();
  });

  feelsToggle.addEventListener("mouseleave", () => {
    tempMap.src = airTempURL + "?ts=" + Date.now();
  });

let showingFeels = false;
feelsToggle.addEventListener("click", () => {
  showingFeels = !showingFeels;
  tempMap.src = (showingFeels ? feelsLikeURL : airTempURL) + "?ts=" + Date.now();

  // visual active state (mobile)
  feelsToggle.classList.toggle("active", showingFeels);
});

}
/* ===== FORCE AIR TEMP MAP BACK EVERY 5 MIN ===== */
setInterval(() => {
  const tempMap = document.getElementById("tempMapImage");
  if (tempMap) {
    tempMap.src =
      "https://data.mesonet.org/data/public/noaa/metar/maps/realtime/latest.tair.png?ts=" +
      Date.now();
  }
}, 300000);









const ccSelect = document.getElementById("currentCitySelect");
const ccStateSelect = document.getElementById("currentStateSelect");

if(!ccSelect || !ccStateSelect){
  console.error("Current Conditions dropdowns not found");
}


ccStateSelect.addEventListener("change",()=>{


  ccSelect.innerHTML='<option value="">Select City</option>';

  const cities = CURRENT_CITY_LIST[ccStateSelect.value];

  if(!cities) return;

Object.entries(cities)
  .sort((a,b)=>{
    const cityA = a[0].split(",")[0];
    const cityB = b[0].split(",")[0];
    return cityA.localeCompare(cityB);
  })
  .forEach(([name,val])=>{

    const cityOnly = name.split(",")[0];
    ccSelect.innerHTML += `<option value="${val}">${cityOnly}</option>`;

  });


});

const mapWrap=document.getElementById("ccMapWrap");
const cityWrap=document.getElementById("ccCityWrap");

const ccCanvas = document.getElementById("ccChart");

let chart;
function applyTempTheme(tempF){

  let gradient, glow, line;

  if(tempF < 45){
    gradient = ["#60a5fa", "#9333ea"];       // cold blue â†’ violet
    glow = "rgba(96,165,250,.7)";
    line = "#60a5fa";
  }
  else if(tempF < 70){
    gradient = ["#38bdf8", "#4ade80"];       // cool aqua â†’ mint
    glow = "rgba(56,189,248,.7)";
    line = "#38bdf8";
  }
  else if(tempF < 85){
    gradient = ["#facc15", "#fb923c"];       // warm yellow â†’ orange
    glow = "rgba(251,146,60,.7)";
    line = "#fb923c";
  }
  else{
    gradient = ["#fb923c", "#ef4444"];       // hot orange â†’ red
    glow = "rgba(239,68,68,.8)";
    line = "#ef4444";
  }

  // Main temp number
  ccTemp.style.background = `linear-gradient(90deg,${gradient[0]},${gradient[1]})`;
  ccTemp.style.webkitBackgroundClip = "text";
  ccTemp.style.webkitTextFillColor = "transparent";
  ccTemp.style.textShadow = `0 0 18px ${glow}`;

  // Save for chart
  window.currentTempLine = line;
  window.currentTempGlow = glow;
}
const SYNOPTIC_TOKEN = "f49abac2473d4bd28ee874139feeb7a7";

const CITY_STATIONS = {
  "45.5152,-122.6784": "KPDX", // Portland Intl
  "34.0522,-118.2437": "KLAX", // Los Angeles Intl
  "32.7157,-117.1611": "KSAN", // San Diego Intl
"37.35917,-121.92417": "KSJC", // San Jose Intl
  "35.1322,-118.4481": "KTSP", // Tehachapi Municipal Airport
"34.0178,-116.1886": { id:"LTHC1", type:"raws" }, // Joshua Tree NP (Lost Horse RAWS ~5300 ft)

"35.0886,-118.6434": "KSVE", // Bear Valley Springs â†’ Stallion Springs Airport




  
  "40.7128,-74.0060": "KNYC", // NYC Central Park
  "41.8781,-87.6298": "KMDW", // Chicago Midway
  // ===== TEXAS STATIONS =====
"32.4487,-99.7331": "KABI",
"35.221997,-101.831297": "KAMA",
"30.0802,-94.1266": "KBPT",
"25.9017,-97.4975": "KBRO",
"30.6744,-96.3698": "KCLL",
"30.6279,-96.3344": "KCLL",
"27.8006,-97.3964": "KCRP",
"31.7619,-106.4850": "KELP",
"29.3013,-94.7977": "KGLS",
"27.5306,-99.4803": "KLRD",
"32.5007,-94.7405": "KGGG",
"33.5779,-101.8552": "KLBB",
"26.2034,-98.2300": "KMFE",
"31.9973,-102.0779": "KMAF",
"31.8457,-102.3676": "KODO",
"31.4638,-100.4370": "KSJT",
"33.4251,-94.0477": "KTXK",
"32.3513,-95.3011": "KTYR",
"31.5493,-97.1467": "KACT",
"33.9137,-98.4934": "KSPS",
"29.7604,-95.3698": "KHOU", // Houston Hobby
  
  "25.7617,-80.1918": "KMIA", // Miami Intl

"36.98217,-122.01533": "KWVI", // Watsonville (Santa Cruz coastal proxy)

// ===== NEW OREGON ADDITIONS =====
"45.1473,-122.5770": "KMMV", // Molalla (McMinnville proxy)
"45.2851,-122.3340": "KTTD", // Estacada (Troutdale proxy)
"45.2465,-122.3915": "KTTD", // Colton (Troutdale proxy)
"45.2943,-123.1757": "KMMV", // Carlton (McMinnville proxy)


  "38.2975,-122.2869": "KAPC", // Napa County Airport
  "33.8303,-116.5453": "KPSP",  // Palm Springs Intl
  "45.6205,-122.6560": "KVUO", // Vancouver Pearson
"45.5404,-122.9498": "KHIO", // Hillsboro
"44.9095,-123.0020": "KSLE", // Salem
"44.1246,-123.2119": "KEUG", // Eugene
"46.1580,-123.8787": "KAST", // Astoria
"46.9694,-122.9025": "KOLM",  // Olympia
  // ===== NEW OREGON + COAST ADDITIONS =====
"44.7546,-122.4787": "KSLE", // Mill City (Salem proxy)
"44.9582,-124.0179": "KONP", // Newport
"44.9918,-124.0150": "KONP", // Lincoln City (Newport proxy)
"43.9826,-124.0998": "KOTH", // Florence (North Bend proxy)
"43.3665,-124.2179": "KOTH", // Coos Bay (North Bend)
// ===== OREGON COAST ROUND 2 =====
"46.1879,-123.8313": "KAST", // Astoria
"45.4565,-123.8426": "KTMK", // Tillamook
"45.9932,-123.9226": "KAST", // Seaside (Astoria proxy)
"42.0526,-124.2839": "KBOK", // Brookings

// ===== NEW OR / WA STATIONS =====

// Oregon
"45.4871,-122.8037": "KHIO", // Beaverton
"44.0582,-121.3153": "KBDN", // Bend
"44.5646,-123.2620": "KCVO", // Corvallis
"45.4982,-122.4315": "KTTD", // Gresham (Troutdale)
"45.2101,-123.1987": "KMMV", // McMinnville
  
"45.5229,-122.9898": "KHIO", // Aloha 
"44.0521,-123.0868": "KEUG", // Coburg
"45.3565,-122.8401": "KHIO", // Sherwood
"45.4326,-122.7715": "KHIO", // King City
"45.1473,-122.8554": "KMMV", // Hubbard
"44.9429,-123.0351": "KSLE", // Four Corners
"44.9901,-123.0262": "KSLE", // Hayesville
"45.2101,-122.9754": "KMMV", // Dundee
"44.0521,-123.1185": "KEUG", // Junction City
"44.0601,-123.0173": "KEUG", // Pleasant Hill
"45.3665,-122.6123": "KTTD", // Gladstone
"45.3140,-122.8568": "KHIO", // Durham
"45.2218,-123.2059": "KMMV", // Lafayette
"45.5184,-122.6726": "KPDX", // Milwaukie (east metro)
"45.2998,-122.7737": "KHIO", // Wilsonville (alt mapping)
"44.7521,-123.0137": "KSLE", // Silverton
"44.8851,-123.0262": "KSLE", // Stayton
"44.6365,-123.1059": "KCVO", // Tangent
"45.3835,-122.7426": "KHIO", // Rivergrove
"45.4396,-122.6948": "KHIO",  // Oak Grove


// Washington





"47.2529,-122.4443": "KTIW", // Tacoma



"48.7519,-122.4787": "KBLI", // Bellingham
"47.9789,-122.2021": "KPAE", // Everett
"46.9694,-122.9025": "KOLM", // Olympia
"47.2529,-122.4443": "KTIW", // Tacoma
"46.6021,-120.5059": "KYKM", // Yakima
"47.6062,-122.3321": "KSEA", // Seattle
"45.6205,-122.6560": "KVUO", // Vancouver WA

"46.1382,-122.9382": "KKLS", // Longview
"48.4212,-122.3340": "KBVS", // Mount Vernon
"48.1181,-123.4307": "KCLM", // Port Angeles
"46.0646,-118.3430": "KALW", // Walla Walla
"47.4235,-120.3103": "KEAT", // Wenatchee
"46.2112,-119.1372": "KPSC", // Kennewick
"46.2857,-119.2845": "KPSC", // Richland
"46.2396,-119.1006": "KPSC", // Pasco
"47.5673,-122.6326": "KPWT", // Bremerton
"46.7162,-122.9543": "KCLS", // Centralia
"46.6620,-122.9640": "KCLS", // Chehalis
"46.7313,-117.1796": "KPUW", // Pullman

// ===== CALIFORNIA ADDITIONS =====
"35.3733,-119.0187": "KBFL", // Bakersfield
"34.2007,-118.3587": "KBUR", // Burbank
"36.7378,-119.7871": "KFAT", // Fresno
"33.8178,-118.1516": "KLGB", // Long Beach
"36.6002,-121.8947": "KMRY", // Monterey
"37.7213,-122.2216": "KOAK", // Oakland
"38.5816,-121.4944": "KSAC", // Sacramento
"35.2828,-120.6596": "KSBP", // San Luis Obispo
"34.4208,-119.6982": "KSBA", // Santa Barbara
"37.9577,-121.2908": "KSCK", // Stockton

 // ===== COACHELLA + MOUNTAINS =====

"33.7222,-116.3745": "KTRM", // Palm Desert
"33.7206,-116.2156": "KTRM", // Indio
"33.6634,-116.3100": "KTRM", // La Quinta
"33.7805,-116.4668": "KPSP", // Cathedral City
"33.7397,-116.4128": "KPSP", // Rancho Mirage
"33.9611,-116.5017": "KPSP", // Desert Hot Springs

"34.2439,-116.9114": { id:"BBBC1", type:"raws" },
"34.2483,-117.1892": { id:"WIDC1", type:"raws", backup:"KONT" }, // Lake Arrowhead
"33.7400,-116.7183": { id:"PNVC1", type:"raws", backup:{ id:"MSJC1", type:"raws" } }, // Idyllwild Pine Cove â†’ fallback Mt San Jacinto


// ===== NEW ADDITIONS =====
"43.1189,-124.4084": "KOTH", // Bandon (North Bend)
"45.3046,-121.7545": "KTTD", // Government Camp (Troutdale proxy)
"45.5946,-121.1787": "KDLS", // The Dalles
"40.8021,-124.1637": "KACV", // Eureka / Arcata Airport
// ===== OREGON â€“ Timberline Lodge =====
"45.32997,-121.71133": { id:"TIM59", type:"raws" },







"33.81528,-116.64194": { id:"MSJC1", type:"raws" },
 // ===== ARIZONA =====

// Phoenix (METAR)
"33.4484,-112.0740": "KPHX",

// Tucson (METAR)
"32.2226,-110.9747": "KTUS",

// Flagstaff (METAR â€“ high elevation)
"35.1983,-111.6513": "KFLG",

// Prescott (RAWS)
"34.5458,-112.4685": { id:"PRES2", type:"raws" },

// Sedona (RAWS)
"34.8673,-111.7610": { id:"SEDZ2", type:"raws" },

  // ===== UTAH STATIONS =====
"40.7608,-111.8910": "KSLC",
"40.2338,-111.6585": "KPVU",
"40.2969,-111.6946": "KPVU",
"41.2230,-111.9738": "KOGD",
"40.6461,-111.4980": "KHCR",
"40.5069,-111.4132": "KHCR",
"41.7370,-111.8338": "KLGU",
"37.0965,-113.5684": "KSGU",
"37.6775,-113.0619": "KCDC",
"38.5733,-109.5498": "KCNY",
"39.5994,-110.8107": "KPUC",
"40.4555,-109.5287": "KVEL",

 // ===== COLORADO STATIONS =====
"39.7392,-104.9903": "KDEN",
"39.1911,-106.8175": "KASE",
"40.01499,-105.27055": "KBDU",
"39.4817,-106.0384": "KCCU",
"37.2753,-107.8801": "KDRO",
"39.5505,-107.3248": "KGWS",
"39.0639,-108.5506": "KGJT",
"40.1672,-105.1019": "KLMO",
"40.3978,-105.07498": "KFNL",
"38.2544,-104.6091": "KPUB",
"40.48498,-106.8317": "KSBS",
"37.9375,-107.8123": "KTEX",
"39.6403,-106.3742": "KEGE",
"39.8917,-105.7631": "KBJC",
 
// ===== WYOMING STATIONS =====
"42.8666,-106.3131": "KCPR",
"41.1400,-104.8202": "KCYS",
"44.5263,-109.0565": "KCOD",
"41.2683,-110.9632": "KEVW",
"44.2911,-105.5022": "KGCC",
"43.4799,-110.7624": "KJAC",
"41.3114,-105.5911": "KLAR",
"43.0240,-108.3801": "KRIW",
"41.5875,-109.2029": "KRKS",
"44.7972,-106.9562": "KSHR",

// ===== MONTANA STATIONS =====
"45.7833,-108.5007": "KBIL",
"45.6770,-111.0429": "KBZN",
"46.0038,-112.5348": "KBTM",
"47.5053,-111.3008": "KGTF",
"48.5497,-109.6841": "KHVR",
"46.5884,-112.0245": "KHLN",
"48.1919,-114.3168": "KGPI",
"46.4083,-105.8406": "KMLS",
"46.8721,-113.9940": "KMSO",
"48.4111,-114.3375": "KGPI",

// ===== NORTH DAKOTA STATIONS =====
"46.8083,-100.7837": "KBIS",
"48.1128,-98.8651": "KDVL",
"46.8792,-102.7896": "KDIK",
"46.8772,-96.7898": "KFAR",
"47.9253,-97.0329": "KGFK",
"46.9105,-98.7084": "KJMS",
"48.2325,-101.2963": "KMOT",
"48.1469,-103.6170": "KISN",
  
// ===== SOUTH DAKOTA STATIONS =====
"45.4647,-98.4865": "KABR",
"44.3114,-96.7984": "KBKX",
"43.7094,-98.0298": "KMHE",
"44.3683,-100.3510": "KPIR",
"44.0805,-103.2310": "KRAP",
"43.5446,-96.7311": "KFSD",
"44.8994,-97.1151": "KATY",
"42.8711,-97.3973": "KYKN",

// ===== NEBRASKA STATIONS =====
"40.9264,-98.3420": "KGRI",
"40.5863,-98.3887": "KHSI",
"40.6995,-99.0815": "KEAR",
"40.8136,-96.7026": "KLNK",
"42.0280,-97.4170": "KOFK",
"41.1403,-100.7601": "KLBF",
"41.2565,-95.9345": "KOMA",
"41.8666,-103.6672": "KBFF",

// ===== IOWA STATIONS =====
"42.0308,-93.6319": "KAMW",
"41.9779,-91.6656": "KCID",
"41.2619,-95.8608": "KCBF",
"41.5236,-90.5776": "KDVN",
"41.5868,-93.6250": "KDSM",
"42.5006,-90.6646": "KDBQ",
"42.4990,-96.4003": "KSUX",
"42.4928,-92.3426": "KALO",

// ===== MISSOURI STATIONS =====
"37.3059,-89.5181": "KCGI",
"38.9517,-92.3341": "KCOU",
"38.5767,-92.1735": "KJEF",
"37.0842,-94.5133": "KJLN",
"39.0997,-94.5786": "KMKC",
"37.2089,-93.2923": "KSGF",
"39.7675,-94.8467": "KSTJ",
"38.6270,-90.1994": "KSTL",

// ===== WISCONSIN STATIONS =====
"44.2619,-88.4154": "KATW",
"44.8113,-91.4985": "KEAU",
"44.5133,-88.0133": "KGRB",
"42.5847,-87.8212": "KENW",
"43.8014,-91.2396": "KLSE",
"43.0731,-89.4012": "KMSN",
"43.0389,-87.9065": "KMKE",
"44.9591,-89.6301": "KAUW",
  
// ===== MINNESOTA STATIONS =====
"47.4736,-94.8803": "KBJI",
"46.7867,-92.1005": "KDLH",
"44.1636,-93.9994": "KMKT",
"44.9778,-93.2650": "KMSP",
"46.8739,-96.7678": "KFAR",
"44.0121,-92.4802": "KRST",
"45.5579,-94.1632": "KSTC",
"44.9537,-93.0900": "KSTP",

"41.8781,-87.6298":"KORD",
"39.7684,-86.1581":"KIND",
"42.3314,-83.0458":"KDTW",
"39.9612,-82.9988":"KCMH",
"38.2527,-85.7585":"KSDF",
"36.1627,-86.7816":"KBNA",
"34.7465,-92.2896":"KLIT",
"29.9511,-90.0715":"KMSY",
"32.2988,-90.1848":"KJAN",
"33.5186,-86.8104":"KBHM",
"32.7765,-79.9311":"KCHS",
"35.2271,-80.8431":"KCLT",
"37.5407,-77.4360":"KRIC",
"38.3498,-81.6326":"KCRW",
"39.9526,-75.1652":"KPHL",
"40.7357,-74.1724":"KEWR",
"39.2904,-76.6122":"KBWI",
"39.7391,-75.5398":"KILG",
"41.7658,-72.6734":"KBDL",
"41.8240,-71.4128":"KPVD",
"42.3601,-71.0589":"KBOS",
"44.4759,-73.2121":"KBTV",
"43.2081,-71.5376":"KCON",
"43.6591,-70.2568":"KPWM",

"42.6526,-73.7562":"KALB",
"42.8142,-73.9396":"KALB",
"42.7284,-73.6918":"KALB",
"41.7004,-73.9210":"KPOU",
"41.5034,-74.0104":"KSWF",
"41.4459,-74.4229":"KSWF",
"41.9270,-73.9974":"KPOU",
"41.0330,-73.7629":"KHPN",
"40.9126,-73.8371":"KLGA",
"40.9115,-73.7824":"KLGA",
"40.7062,-73.6187":"KFRG",
"40.7298,-73.2104":"KISP",
"40.7657,-73.0151":"KISP",
"42.4439,-76.5019":"KITH",
"42.0987,-75.9180":"KBGM",
"42.0898,-76.8077":"KELM",
"43.9748,-75.9108":"KART",
"44.6995,-73.4529":"KPBG",
  
  
  // ===== NEVADA =====

// Las Vegas (METAR)
"36.1699,-115.1398": "KLAS",

// Reno (METAR)
"39.5296,-119.8138": "KRNO",

// Elko (METAR â€“ high desert)
"40.8324,-115.7631": "KEKO",

// Ely (METAR â€“ high elevation)
"39.2472,-114.8880": "KELY",

};

const CITY_NAMES = {
  "45.5152,-122.6784": "Portland, OR",
  "34.0522,-118.2437": "Los Angeles, CA",
  "37.35917,-121.92417": "San Jose, CA",
"36.98217,-122.01533": "Santa Cruz, CA",
  "32.7157,-117.1611": "San Diego, CA",
  "47.6062,-122.3321": "Seattle, WA",
  // ===== OREGON ADDITIONS =====
"45.5229,-122.9898": "Aloha, OR",
"44.0521,-123.0868": "Coburg, OR",
"45.3565,-122.8401": "Sherwood, OR",
"45.4326,-122.7715": "King City, OR",
"45.1473,-122.8554": "Hubbard, OR",
"44.9429,-123.0351": "Four Corners, OR",
"44.9901,-123.0262": "Hayesville, OR",
"45.2101,-122.9754": "Dundee, OR",
"44.0521,-123.1185": "Junction City, OR",
"44.0601,-123.0173": "Pleasant Hill, OR",
"45.3665,-122.6123": "Gladstone, OR",
"45.3140,-122.8568": "Durham, OR",
"45.2218,-123.2059": "Lafayette, OR",
"45.5184,-122.6726": "Milwaukie, OR",
"45.2998,-122.7737": "Wilsonville, OR",
"44.7521,-123.0137": "Silverton, OR",
"44.8851,-123.0262": "Stayton, OR",
"44.6365,-123.1059": "Tangent, OR",
"45.3835,-122.7426": "Rivergrove, OR",
"45.4396,-122.6948": "Oak Grove, OR",
"45.1473,-122.5770": "Molalla, OR",
"45.2851,-122.3340": "Estacada, OR",
"45.2465,-122.3915": "Colton, OR",
"45.2943,-123.1757": "Carlton, OR",
"44.7546,-122.4787": "Mill City, OR",
"44.9918,-124.0150": "Lincoln City, OR",
"44.9582,-124.0179": "Newport, OR",
"43.9826,-124.0998": "Florence, OR",
"43.3665,-124.2179": "Coos Bay, OR",
"46.1879,-123.8313": "Astoria, OR",
"45.4565,-123.8426": "Tillamook, OR",
"45.9932,-123.9226": "Seaside, OR",
"42.0526,-124.2839": "Brookings, OR",

  
  "41.8781,-87.6298": "Chicago, IL",
  // ===== TEXAS =====
"32.4487,-99.7331": "Abilene, TX",
"35.221997,-101.831297": "Amarillo, TX",
"30.0802,-94.1266": "Beaumont, TX",
"25.9017,-97.4975": "Brownsville, TX",
"30.6744,-96.3698": "Bryan, TX",
"30.6279,-96.3344": "College Station, TX",
"27.8006,-97.3964": "Corpus Christi, TX",
"31.7619,-106.4850": "El Paso, TX",
"29.3013,-94.7977": "Galveston, TX",
"29.7604,-95.3698": "Houston, TX",
"27.5306,-99.4803": "Laredo, TX",
"32.5007,-94.7405": "Longview, TX",
"33.5779,-101.8552": "Lubbock, TX",
"26.2034,-98.2300": "McAllen, TX",
"31.9973,-102.0779": "Midland, TX",
"31.8457,-102.3676": "Odessa, TX",
"31.4638,-100.4370": "San Angelo, TX",
"33.4251,-94.0477": "Texarkana, TX",
"32.3513,-95.3011": "Tyler, TX",
"31.5493,-97.1467": "Waco, TX",
"33.9137,-98.4934": "Wichita Falls, TX",

  
  "25.7617,-80.1918": "Miami, FL",
  
  // ===== COLORADO =====
"39.7392,-104.9903": "Denver, CO",
"39.1911,-106.8175": "Aspen, CO",
"40.01499,-105.27055": "Boulder, CO",
"39.4817,-106.0384": "Breckenridge, CO",
"37.2753,-107.8801": "Durango, CO",
"39.5505,-107.3248": "Glenwood Springs, CO",
"39.0639,-108.5506": "Grand Junction, CO",
"40.1672,-105.1019": "Longmont, CO",
"40.3978,-105.07498": "Loveland, CO",
"38.2544,-104.6091": "Pueblo, CO",
"40.48498,-106.8317": "Steamboat Springs, CO",
"37.9375,-107.8123": "Telluride, CO",
"39.6403,-106.3742": "Vail, CO",
"39.8917,-105.7631": "Winter Park, CO",

  "38.2975,-122.2869": "Napa, CA",
  "33.8303,-116.5453": "Palm Springs, CA",
  "43.1189,-124.4084": "Bandon, OR",
"45.3046,-121.7545": "Government Camp, OR",
"45.5946,-121.1787": "The Dalles, OR",
  "45.32997,-121.71133": "Timberline Lodge, OR",

"40.8021,-124.1637": "Eureka, CA",
  "35.1322,-118.4481": "Tehachapi, CA",
"35.0886,-118.6434": "Bear Valley Springs, CA",
"34.0178,-116.1886": "Joshua Tree, CA",




"45.6205,-122.6560": "Vancouver, WA",
"45.5404,-122.9498": "Hillsboro, OR",
"44.9095,-123.0020": "Salem, OR",
"44.1246,-123.2119": "Eugene, OR",
"46.1580,-123.8787": "Astoria, OR",
"46.9694,-122.9025": "Olympia, WA",
"45.4871,-122.8037": "Beaverton, OR",
"44.0582,-121.3153": "Bend, OR",
"44.5646,-123.2620": "Corvallis, OR",
"45.4982,-122.4315": "Gresham, OR",
"45.2101,-123.1987": "McMinnville, OR",
"48.7519,-122.4787": "Bellingham, WA",
"47.9789,-122.2021": "Everett, WA",
// ===== WASHINGTON (Current Conditions) =====
"48.7519,-122.4787": "Bellingham, WA",
"47.9789,-122.2021": "Everett, WA",
"46.9694,-122.9025": "Olympia, WA",
"47.2529,-122.4443": "Tacoma, WA",
"46.6021,-120.5059": "Yakima, WA",
"47.6062,-122.3321": "Seattle, WA",


"46.1382,-122.9382": "Longview, WA",
"48.4212,-122.3340": "Mount Vernon, WA",
"48.1181,-123.4307": "Port Angeles, WA",
"46.0646,-118.3430": "Walla Walla, WA",
"47.4235,-120.3103": "Wenatchee, WA",
"46.2112,-119.1372": "Kennewick, WA",
"46.2857,-119.2845": "Richland, WA",
"46.2396,-119.1006": "Pasco, WA",
"47.5673,-122.6326": "Bremerton, WA",
"46.7162,-122.9543": "Centralia, WA",
"46.6620,-122.9640": "Chehalis, WA",
"46.7313,-117.1796": "Pullman, WA",


// ===== CALIFORNIA ADDITIONS =====
"35.3733,-119.0187": "Bakersfield, CA",
"34.2007,-118.3587": "Burbank, CA",
"36.7378,-119.7871": "Fresno, CA",
"33.8178,-118.1516": "Long Beach, CA",
"36.6002,-121.8947": "Monterey, CA",
"37.7213,-122.2216": "Oakland, CA",
"38.5816,-121.4944": "Sacramento, CA",
"35.2828,-120.6596": "San Luis Obispo, CA",
"34.4208,-119.6982": "Santa Barbara, CA",
"37.9577,-121.2908": "Stockton, CA",
"33.7222,-116.3745": "Palm Desert, CA",
"33.7206,-116.2156": "Indio, CA",
"33.6634,-116.3100": "La Quinta, CA",
"33.7805,-116.4668": "Cathedral City, CA",
"33.7397,-116.4128": "Rancho Mirage, CA",
"33.9611,-116.5017": "Desert Hot Springs, CA",

"34.2439,-116.9114": "Big Bear Lake, CA",
"34.2483,-117.1892": "Lake Arrowhead, CA",
"33.7400,-116.7183": "Idyllwild, CA",
"33.81528,-116.64194": "Mt San Jacinto, CA",
// ===== ARIZONA =====
"33.4484,-112.0740": "Phoenix, AZ",
"32.2226,-110.9747": "Tucson, AZ",
"35.1983,-111.6513": "Flagstaff, AZ",
"34.5458,-112.4685": "Prescott, AZ",
"34.8673,-111.7610": "Sedona, AZ",
// ===== NEVADA =====
"36.1699,-115.1398": "Las Vegas, NV",
"39.5296,-119.8138": "Reno, NV",
"40.8324,-115.7631": "Elko, NV",
"39.2472,-114.8880": "Ely, NV",
// ===== UTAH =====
"40.7608,-111.8910": "Salt Lake City, UT",
"40.2338,-111.6585": "Provo, UT",
"40.2969,-111.6946": "Orem, UT",
"41.2230,-111.9738": "Ogden, UT",
"40.6461,-111.4980": "Park City, UT",
"40.5069,-111.4132": "Heber City, UT",
"41.7370,-111.8338": "Logan, UT",
"37.0965,-113.5684": "St George, UT",
"37.6775,-113.0619": "Cedar City, UT",
"38.5733,-109.5498": "Moab, UT",
"39.5994,-110.8107": "Price, UT",
"40.4555,-109.5287": "Vernal, UT",  
// ===== WYOMING =====
"42.8666,-106.3131": "Casper, WY",
"41.1400,-104.8202": "Cheyenne, WY",
"44.5263,-109.0565": "Cody, WY",
"41.2683,-110.9632": "Evanston, WY",
"44.2911,-105.5022": "Gillette, WY",
"43.4799,-110.7624": "Jackson, WY",
"41.3114,-105.5911": "Laramie, WY",
"43.0240,-108.3801": "Riverton, WY",
"41.5875,-109.2029": "Rock Springs, WY",
"44.7972,-106.9562": "Sheridan, WY",
// ===== MONTANA =====
"45.7833,-108.5007": "Billings, MT",
"45.6770,-111.0429": "Bozeman, MT",
"46.0038,-112.5348": "Butte, MT",
"47.5053,-111.3008": "Great Falls, MT",
"48.5497,-109.6841": "Havre, MT",
"46.5884,-112.0245": "Helena, MT",
"48.1919,-114.3168": "Kalispell, MT",
"46.4083,-105.8406": "Miles City, MT",
"46.8721,-113.9940": "Missoula, MT",
"48.4111,-114.3375": "Whitefish, MT",

// ===== NORTH DAKOTA =====
"46.8083,-100.7837": "Bismarck, ND",
"48.1128,-98.8651": "Devils Lake, ND",
"46.8792,-102.7896": "Dickinson, ND",
"46.8772,-96.7898": "Fargo, ND",
"47.9253,-97.0329": "Grand Forks, ND",
"46.9105,-98.7084": "Jamestown, ND",
"48.2325,-101.2963": "Minot, ND",
"48.1469,-103.6170": "Williston, ND",

// ===== SOUTH DAKOTA =====
"45.4647,-98.4865": "Aberdeen, SD",
"44.3114,-96.7984": "Brookings, SD",
"43.7094,-98.0298": "Mitchell, SD",
"44.3683,-100.3510": "Pierre, SD",
"44.0805,-103.2310": "Rapid City, SD",
"43.5446,-96.7311": "Sioux Falls, SD",
"44.8994,-97.1151": "Watertown, SD",
"42.8711,-97.3973": "Yankton, SD",

// ===== NEBRASKA =====
"40.9264,-98.3420": "Grand Island, NE",
"40.5863,-98.3887": "Hastings, NE",
"40.6995,-99.0815": "Kearney, NE",
"40.8136,-96.7026": "Lincoln, NE",
"42.0280,-97.4170": "Norfolk, NE",
"41.1403,-100.7601": "North Platte, NE",
"41.2565,-95.9345": "Omaha, NE",
"41.8666,-103.6672": "Scottsbluff, NE",

// ===== IOWA =====
"42.0308,-93.6319": "Ames, IA",
"41.9779,-91.6656": "Cedar Rapids, IA",
"41.2619,-95.8608": "Council Bluffs, IA",
"41.5236,-90.5776": "Davenport, IA",
"41.5868,-93.6250": "Des Moines, IA",
"42.5006,-90.6646": "Dubuque, IA",
"42.4990,-96.4003": "Sioux City, IA",
"42.4928,-92.3426": "Waterloo, IA",

// ===== MISSOURI =====
"37.3059,-89.5181": "Cape Girardeau, MO",
"38.9517,-92.3341": "Columbia, MO",
"38.5767,-92.1735": "Jefferson City, MO",
"37.0842,-94.5133": "Joplin, MO",
"39.0997,-94.5786": "Kansas City, MO",
"37.2089,-93.2923": "Springfield, MO",
"39.7675,-94.8467": "St Joseph, MO",
"38.6270,-90.1994": "St Louis, MO",
  
  
// ===== WISCONSIN =====
"44.2619,-88.4154": "Appleton, WI",
"44.8113,-91.4985": "Eau Claire, WI",
"44.5133,-88.0133": "Green Bay, WI",
"42.5847,-87.8212": "Kenosha, WI",
"43.8014,-91.2396": "La Crosse, WI",
"43.0731,-89.4012": "Madison, WI",
"43.0389,-87.9065": "Milwaukee, WI",
"44.9591,-89.6301": "Wausau, WI",

// ===== MINNESOTA =====
"47.4736,-94.8803": "Bemidji, MN",
"46.7867,-92.1005": "Duluth, MN",
"44.1636,-93.9994": "Mankato, MN",
"44.9778,-93.2650": "Minneapolis, MN",
"46.8739,-96.7678": "Moorhead, MN",
"44.0121,-92.4802": "Rochester, MN",
"45.5579,-94.1632": "St Cloud, MN",
"44.9537,-93.0900": "St Paul, MN",
  
"41.8781,-87.6298":"Chicago, IL",
"39.7684,-86.1581":"Indianapolis, IN",
"42.3314,-83.0458":"Detroit, MI",
"39.9612,-82.9988":"Columbus, OH",
"38.2527,-85.7585":"Louisville, KY",
"36.1627,-86.7816":"Nashville, TN",
"34.7465,-92.2896":"Little Rock, AR",
"29.9511,-90.0715":"New Orleans, LA",
"32.2988,-90.1848":"Jackson, MS",
"33.5186,-86.8104":"Birmingham, AL",
"32.7765,-79.9311":"Charleston, SC",
"35.2271,-80.8431":"Charlotte, NC",
"37.5407,-77.4360":"Richmond, VA",
"38.3498,-81.6326":"Charleston, WV",
"39.9526,-75.1652":"Philadelphia, PA",
"40.7357,-74.1724":"Newark, NJ",
"39.2904,-76.6122":"Baltimore, MD",
"39.7391,-75.5398":"Wilmington, DE",
"41.7658,-72.6734":"Hartford, CT",
"41.8240,-71.4128":"Providence, RI",
"42.3601,-71.0589":"Boston, MA",
"44.4759,-73.2121":"Burlington, VT",
"43.2081,-71.5376":"Concord, NH",
"43.6591,-70.2568":"Portland, ME",

"42.6526,-73.7562":"Albany, NY",
"42.8142,-73.9396":"Schenectady, NY",
"42.7284,-73.6918":"Troy, NY",
"41.7004,-73.9210":"Poughkeepsie, NY",
"41.5034,-74.0104":"Newburgh, NY",
"41.4459,-74.4229":"Middletown, NY",
"41.9270,-73.9974":"Kingston, NY",
"41.0330,-73.7629":"White Plains, NY",
"40.9126,-73.8371":"Mount Vernon, NY",
"40.9115,-73.7824":"New Rochelle, NY",
"40.7062,-73.6187":"Hempstead, NY",
"40.7298,-73.2104":"Islip, NY",
"40.7657,-73.0151":"Patchogue, NY",
"42.4439,-76.5019":"Ithaca, NY",
"42.0987,-75.9180":"Binghamton, NY",
"42.0898,-76.8077":"Elmira, NY",
"43.9748,-75.9108":"Watertown, NY",
"44.6995,-73.4529":"Plattsburgh, NY",
"40.7128,-74.0060": "New York, NY",  
};



const CURRENT_CITY_LIST = {};

Object.entries(CITY_NAMES).forEach(([coords,name])=>{

  const parts = name.split(", ");
  if(parts.length<2) return;

  const state = parts[1].trim();

  if(!CURRENT_CITY_LIST[state]) CURRENT_CITY_LIST[state]={};

  CURRENT_CITY_LIST[state][name]=coords;

});
// Populate State dropdown (alphabetized)
ccStateSelect.innerHTML = '<option value="">Select State</option>';

Object.keys(CURRENT_CITY_LIST)
  .sort()
  .forEach(state=>{
    ccStateSelect.innerHTML += `<option value="${state}">${state}</option>`;
  });

async function fetchRAWS(stationId){

  const url =
    `https://api.synopticdata.com/v2/stations/latest?stid=${stationId}&token=${SYNOPTIC_TOKEN}&units=english&recent=120`;

  const r = await fetch(url);
  const j = await r.json();

  if(!j.STATION || !j.STATION.length) return null;

  return j.STATION[0];
}


function calcConfidence(nextTemps){

  if(!nextTemps || nextTemps.length < 2) return "Confidence: â€”";

  const max = Math.max(...nextTemps);
  const min = Math.min(...nextTemps);
  const spread = max - min;

  if(spread < 3) return "ðŸŸ¢ Confidence: High";
  if(spread < 6) return "ðŸŸ¡ Confidence: Moderate";
  return "ðŸ”´ Confidence: Low";
}
  
async function loadCity(lat,lon){

mapWrap.style.display="none";
cityWrap.style.display="block";

const p = await fetch(`https://api.weather.gov/points/${lat},${lon}`);
const pj = await p.json();

// NEXT 12 HOURS
const hourlyResp = await fetch(pj.properties.forecastHourly);
const hourlyJSON = await hourlyResp.json();

const nextTemps = hourlyJSON.properties.periods
  .slice(0,12)
  .map(h => h.temperature);

document.getElementById("ccConfidence").textContent =
  calcConfidence(nextTemps);
  // ===== SUNRISE / SUNSET =====
try {
  const sunResp = await fetch(`https://api.sunrise-sunset.org/json?lat=${lat}&lng=${lon}&formatted=0`);
  const sunJSON = await sunResp.json();

  document.getElementById("ccSunrise").textContent =
    new Date(sunJSON.results.sunrise).toLocaleTimeString([], {
      hour: "numeric",
      minute: "2-digit"
    });
// ===== AMBIENT DAY / NIGHT MODE (Portland) =====
const now = new Date();
const sunrise = new Date(sunJSON.results.sunrise);
const sunset = new Date(sunJSON.results.sunset);

document.body.classList.remove("day","night");

if(now > sunrise && now < sunset){
  document.body.classList.add("day");
}else{
  document.body.classList.add("night");
}

  document.getElementById("ccSunset").textContent =
    new Date(sunJSON.results.sunset).toLocaleTimeString([], {
      hour: "numeric",
      minute: "2-digit"
    });

} catch {
  document.getElementById("ccSunrise").textContent = "â€”";
  document.getElementById("ccSunset").textContent = "â€”";
}



const key = `${lat},${lon}`;
 

document.getElementById("ccCity").textContent = CITY_NAMES[key] || "Selected City";

const station = CITY_STATIONS[key];

if(!station){
  alert("Station not defined for this city.");
  return;
}

/* RAWS station */
if(typeof station === "object" && station.type === "raws"){
if(chart){
  chart.destroy();
  chart = null;
}


  let raws = await fetchRAWS(station.id);

  // fallback to airport if RAWS dead
  if(!raws && station.backup){

    const r = await fetch(`https://api.weather.gov/stations/${station.backup}/observations/latest`);
    const j = await r.json();
    const latest = j.properties;

    ccTemp.textContent = Math.round(latest.temperature.value*9/5+32)+"Â°";
    ccWx.innerHTML="Sky <span>"+latest.textDescription+"</span>";
    ccWind.innerHTML="Wind <span>"+Math.round(latest.windSpeed.value*2.23694)+" mph</span>";
    ccHum.innerHTML="Humidity <span>"+Math.round(latest.relativeHumidity.value)+"%</span>";
    ccDew.innerHTML="Dew Point <span>"+Math.round(latest.dewpoint.value*9/5+32)+"Â°</span>";

    return;
  }

  if(!raws){
    alert("Mountain station offline");
    return;
  }

  const obs = raws.OBSERVATIONS;
  const temp =
    obs.air_temp_value_1?.value ??
    obs.air_temp_value_2?.value;

  if(temp == null){
    alert("Temperature unavailable");
    return;
  }

  ccTemp.textContent = Math.round(temp) + "Â°";
  ccHum.innerHTML = `Humidity <span>${obs.relative_humidity_value_1?.value != null ? Math.round(obs.relative_humidity_value_1.value)+"%" : "â€”"}</span>`;
  ccDew.innerHTML = `Dew Point <span>${obs.dew_point_temperature_value_1?.value != null ? Math.round(obs.dew_point_temperature_value_1.value)+"Â°" : "â€”"}</span>`;
  ccWind.innerHTML = `Wind <span>${obs.wind_speed_value_1?.value != null ? Math.round(obs.wind_speed_value_1.value)+" mph" : "â€”"}</span>`;
  ccWx.innerHTML = "Sky <span>Mountain Station</span>";

  return;

}

/* NOAA METAR continues below */
const stationURL = `https://api.weather.gov/stations/${station}`;





/* last 12 hours */
const end=new Date().toISOString();
const start=new Date(Date.now()-12*3600000).toISOString();

const obsResp = await fetch(`${stationURL}/observations?start=${start}&end=${end}`);
const oj = await obsResp.json();


const temps=[];
const labels=[];

oj.features.reverse().forEach(o=>{
  if(o.properties.temperature.value){
    temps.push(o.properties.temperature.value*9/5+32);
    labels.push(
  new Date(o.properties.timestamp).toLocaleTimeString([], {
    hour: 'numeric',
    hour12: true
  })
);

  }
});

let latest;

if(!oj.features.length){

  // CWOP fallback (no history available)
  const lr = await fetch(`${stationURL}/observations/latest`);
  const lj = await lr.json();
  latest = lj.properties;

}else{

  latest = oj.features[oj.features.length-1].properties;

}


if(latest.temperature?.value == null){

if(chart){
  chart.destroy();
  chart = null;
}

ccTemp.textContent = "â€”";
ccWx.innerHTML = "Sky <span>Station offline</span>";
return;
}


const tempF = Math.round(latest.temperature.value*9/5+32);
ccTemp.textContent = tempF + "Â°";
applyTempTheme(tempF);

ccFeels.textContent = latest.apparentTemperature?.value
  ? "Feels Like " + Math.round(latest.apparentTemperature.value*9/5+32) + "Â°"
  : "";

ccWx.innerHTML="Sky <span>"+latest.textDescription+"</span>";
latest.windSpeed = latest.windSpeed || latest.windGust;
const windDir = latest.windDirection?.value
  ? ["N","NE","E","SE","S","SW","W","NW"][Math.round(latest.windDirection.value/45)%8]
  : "";
latest.windSpeed = latest.windSpeed || latest.windGust;
// Use sustained wind, not gusts
let windMPH = "â€”";

if(latest.windSpeed?.value != null){

  const v = latest.windSpeed.value;
  const unit = latest.windSpeed.unitCode;

  // meters per second
  if(unit && unit.includes("m_s-1")){
    windMPH = Math.round(v * 2.23694);
  }

  // kilometers per hour
  else if(unit && unit.includes("km_h-1")){
    windMPH = Math.round(v * 0.621371);
  }

}




ccWind.innerHTML = `Wind <span>${windMPH} mph ${windDir}</span>`;



ccHum.innerHTML="Humidity <span>"+Math.round(latest.relativeHumidity.value)+"%</span>";

ccDew.innerHTML="Dew Point <span>"+Math.round(latest.dewpoint.value*9/5+32)+"Â°</span>";
/* ===== PRECIP (PRO MODE) ===== */

// Precip since midnight
if(latest.precipitationSinceMidnight?.value != null){
  const inches = latest.precipitationSinceMidnight.value * 39.3701;
  ccRainDay.innerHTML = `Precip Today <span>${inches.toFixed(2)} in</span>`;
}else{
  ccRainDay.innerHTML = "Precip Today <span>â€”</span>";
}

// Precip last hour
if(latest.precipitationLastHour?.value != null){
  const hr = latest.precipitationLastHour.value * 39.3701;
  ccRainMonth.innerHTML = `Last Hour <span>${hr.toFixed(2)} in</span>`;
}else{
  ccRainMonth.innerHTML = "Last Hour <span>â€”</span>";
  /* ===== MONTHLY PRECIP (CLIMATE DATA) ===== */

try{

  const now = new Date();
  const y = now.getFullYear();
  const m = String(now.getMonth()+1).padStart(2,"0");

  const start = `${y}-${m}-01`;
  const end = now.toISOString().slice(0,10);

  const climateURL =
   `https://www.ncei.noaa.gov/access/services/data/v1?dataset=daily-summaries&stations=${station}&startDate=${start}&endDate=${end}&dataTypes=PRCP&units=standard&format=json`;

  const clim = await fetch(climateURL);
  const cj = await clim.json();

  let total = 0;

  cj.forEach(d=>{
    if(d.PRCP) total += parseFloat(d.PRCP);
  });

  if(total>0){
    ccRainMonth.innerHTML += `<br>Monthly <span>${total.toFixed(2)} in</span>`;
  }

}catch(e){
  console.warn("Monthly precip unavailable");
}

}









ccUpdated.textContent="Updated "+new Date(latest.timestamp).toLocaleTimeString();


/* Chart */
if(chart) chart.destroy();

const ctx = ccCanvas.getContext("2d");

// Broadcast-style glowing + pulsing temp labels
const tempLabelPlugin = {
  id: 'tempLabels',
  afterDatasetsDraw(chart){
    const {ctx} = chart;
    const meta = chart.getDatasetMeta(0);
    const data = chart.data.datasets[0].data;

    if(!data.length) return;

    const n = data.length - 1;

    // indices ~ latest-10h, -6h, -2h
    const idx2  = Math.max(0, Math.round(n * (10/12)));
    const idx6  = Math.max(0, Math.round(n * (6/12)));
    const idx10 = Math.max(0, Math.round(n * (2/12)));

    const points = [idx10, idx6, idx2];

    // subtle pulse
    const pulse = Math.sin(Date.now()/600) * 2;

    ctx.save();
    ctx.font = "12px system-ui";           // slightly bigger
    ctx.textAlign = "center";
    ctx.fillStyle = "#e5e7eb";

    ctx.shadowColor = "rgba(56,189,248,.8)";
    ctx.shadowBlur = 10;

    points.forEach(i=>{
      const pt = meta.data[i];
      if(!pt) return;

      const val = Math.round(data[i]);

      // lift higher + pulse
const mobile = window.innerWidth < 768;

// target position (normal float)
let y = pt.y - 32 + pulse;

// HARD minimum distance above line (never touch)
const minAboveLine = 26;
y = Math.min(y, pt.y - minAboveLine);

// Mobile ceiling (donâ€™t escape canvas)
if(mobile){
  y = Math.max(y, 36);
}

ctx.fillText(val + "Â°", pt.x, y);




    });

    ctx.restore();
  }
};



      



chart=new Chart(ctx,{
 type:"line",
 data:{
   labels,
datasets:[
{
  label:"Observed",
  data:temps,
  borderWidth:3,
  tension:.4,
  fill:true,
  pointRadius:0,
  borderColor: window.currentTempLine || "#38bdf8",
  backgroundColor:(ctx)=>{
    const g=ctx.chart.ctx.createLinearGradient(0,0,0,200);
    g.addColorStop(0,"rgba(250,204,21,.45)");
    g.addColorStop(.5, window.currentTempGlow || "rgba(56,189,248,.25)");
    g.addColorStop(1,"rgba(37,99,235,.15)");
    return g;
  }
},

{
  label:"Next 12 Hours",
  data:[...Array(temps.length-1).fill(null), ...nextTemps],
  borderDash:[6,6],
  borderColor:"#4ade80",
  tension:.4,
  pointRadius:0,
  fill:false
}
]
 },

 plugins:[tempLabelPlugin],   // ðŸ‘ˆ ADD THIS LINE

 options:{
  responsive:true,

 

  plugins:{
    legend:{display:false},
  

  },

  scales:{
    x:{
      ticks:{
        color:"#64748b",
        maxTicksLimit: window.innerWidth < 768 ? 6 : 12,
        font:{
          size: window.innerWidth < 768 ? 9 : 11
        }
      },
      grid:{display:false}
    },

    y:{
      ticks:{
        color:"#64748b",
        padding:6,
        font:{
          size: window.innerWidth < 768 ? 9 : 11
        }
      },
      grid:{color:"rgba(255,255,255,.04)"},
      grace:"20%"
    }
  }
}

});



}

ccSelect.addEventListener("change",()=>{

if(!ccSelect.value){
  cityWrap.style.display="none";
  mapWrap.style.display="block";
  if(feelsToggle) feelsToggle.style.display="inline";
  return;
}


 // Hide Feels Like when city mode is active
 if(feelsToggle) feelsToggle.style.display="none";

 const [lat,lon]=ccSelect.value.split(",");
 loadCity(lat,lon);
});



  


  
  
</script>


<script>
(function(){

const grid=document.getElementById("forecastGrid");
const tsEl=document.getElementById("forecastTimestamp");
const refreshBtn=document.getElementById("forecastRefreshBtn");
const citySelect=document.getElementById("forecastCitySelect");
const forecastStateSelect=document.getElementById("forecastStateSelect");

const hourlyWrap=document.getElementById("hourlyWrap");
const hourRail=document.getElementById("hourRail");


if(!grid || !citySelect || !forecastStateSelect){

 console.error("Forecast DOM not found");
 return;
}


const FORECAST_POINTS={

  
  
// ================= CALIFORNIA (38) =================
CA:{
"Anaheim":"33.8366,-117.9143",
"Bakersfield":"35.3733,-119.0187",
"Bear Valley Springs":"35.1500,-118.6000",
"Big Bear Lake":"34.2439,-116.9114",
"Burbank":"34.2007,-118.3587",
"Cathedral City":"33.7805,-116.4668",
"Chula Vista":"32.6401,-117.0842",
"Corona":"33.8753,-117.5664",
"Desert Hot Springs":"33.9611,-116.5017",
  "Eureka":"40.8021,-124.1637",
"Fresno":"36.7378,-119.7871",
"Fullerton":"33.8704,-117.9243",
"Garden Grove":"33.7739,-117.9414",
"Huntington Beach":"33.6595,-117.9988",
"Idyllwild":"33.7400,-116.7183",
"Indio":"33.7206,-116.2156",
"Irvine":"33.6846,-117.8265",
"Joshua Tree":"34.0178,-116.1886",
"La Quinta":"33.6634,-116.3100",
"Long Beach":"33.8178,-118.1516",
"Los Angeles":"34.0522,-118.2437",
"Morongo Valley":"34.0464,-116.5806",
"Napa":"38.2975,-122.2869",
"Oakland":"37.7213,-122.2216",
"Palm Springs":"33.8303,-116.5453",
"Rancho Mirage":"33.7397,-116.4128",
"Riverside":"33.9806,-117.3755",
"Sacramento":"38.5816,-121.4944",
"San Bernardino":"34.1083,-117.2898",
"San Diego":"32.7157,-117.1611",
"San Jose":"37.3382,-121.8863",
"San Luis Obispo":"35.2828,-120.6596",
"Santa Ana":"33.7455,-117.8677",
"Santa Barbara":"34.4208,-119.6982",
"Stockton":"37.9577,-121.2908",
"Tehachapi":"35.1322,-118.4481"
},

// ================= OREGON (20) =================
OR:{
"Albany":"44.6365,-123.1059",
"Aloha":"45.5229,-122.9898",
  "Astoria":"46.1879,-123.8313",
"Beaverton":"45.4871,-122.8037",
  "Brookings":"42.0526,-124.2839",
  "Carlton":"45.2943,-123.1757",
"Coburg":"44.0521,-123.0868",
  "Colton":"45.2465,-122.3915",
  "Coos Bay":"43.3665,-124.2179",
"Corvallis":"44.5646,-123.2620",
"Dundee":"45.2101,-122.9754",
"Durham":"45.3140,-122.8568",
  "Estacada":"45.2851,-122.3340",
"Eugene":"44.1246,-123.2119",
  "Florence":"43.9826,-124.0998",
"Four Corners":"44.9429,-123.0351",
"Gladstone":"45.3665,-122.6123",
"Gresham":"45.4982,-122.4315",
"Government Camp":"45.3046,-121.7545",
"Hayesville":"44.9901,-123.0262",
"Hillsboro":"45.5404,-122.9498",
"Hubbard":"45.1473,-122.8554",
"Junction City":"44.0521,-123.1185",
"Keizer":"44.9901,-123.0262",
"King City":"45.4326,-122.7715",
"Lake Oswego":"45.4207,-122.6706",
"Lafayette":"45.2218,-123.2059",
  "Lincoln City":"44.9918,-124.0150",
"McMinnville":"45.2101,-123.1987",
"Medford":"42.3265,-122.8756",
"Milwaukie":"45.5184,-122.6726",
  "Mill City":"44.7546,-122.4787",
  "Molalla":"45.1473,-122.5770",
  "Newport":"44.9582,-124.0179",
"Oak Grove":"45.4396,-122.6948",
"Oregon City":"45.3573,-122.6068",
"Pleasant Hill":"44.0601,-123.0173",
"Portland":"45.5152,-122.6784",
"Rivergrove":"45.3835,-122.7426",
"Salem":"44.9095,-123.0020",
  "Seaside":"45.9932,-123.9226",
"Sherwood":"45.3565,-122.8401",
"Silverton":"44.7521,-123.0137",
"Springfield":"44.0462,-123.0220",
"Stayton":"44.8851,-123.0262",
  "Tillamook":"45.4565,-123.8426",
"Timberline Lodge":"45.32997,-121.71133",
"Tigard":"45.4312,-122.7715",
"Tualatin":"45.3840,-122.7638",
"West Linn":"45.3657,-122.6123",
"Wilsonville":"45.2998,-122.7737",
"Woodburn":"45.1437,-122.8554"
},



// ================= WASHINGTON (15) =================
WA:{
"Bellingham":"48.7519,-122.4787",
"Bremerton":"47.5673,-122.6326",
"Centralia":"46.7162,-122.9543",
"Chehalis":"46.6620,-122.9640",
"Everett":"47.9789,-122.2021",
"Federal Way":"47.3223,-122.3126",
"Kennewick":"46.2112,-119.1372",
"Kirkland":"47.6769,-122.2060",
"Longview":"46.1382,-122.9382",
"Marysville":"48.0518,-122.1771",
"Mount Vernon":"48.4212,-122.3340",
"Olympia":"46.9694,-122.9025",
"Pasco":"46.2396,-119.1006",
"Port Angeles":"48.1181,-123.4307",
"Pullman":"46.7313,-117.1796",
"Redmond":"47.6730,-122.1215",
"Renton":"47.4829,-122.2171",
"Richland":"46.2857,-119.2845",
"Seattle":"47.6062,-122.3321",
"Spokane":"47.6588,-117.4260",
"Tacoma":"47.2529,-122.4443",
"Vancouver":"45.6205,-122.6560",
"Walla Walla":"46.0646,-118.3430",
"Wenatchee":"47.4235,-120.3103",
"Yakima":"46.6021,-120.5059"
},


// ================= ALL OTHER STATES (TOP ~5 EACH) =================

AZ:{
  "Chandler":"33.3062,-111.8413",
  "Flagstaff":"35.1983,-111.6513",
  "Glendale":"33.5387,-112.1860",
  "Mesa":"33.4152,-111.8315",
  "Phoenix":"33.4484,-112.0740",
  "Prescott":"34.5458,-112.4685",
  "Sedona":"34.8673,-111.7610",
  "Tucson":"32.2226,-110.9747"
},

CO:{
"Denver":"39.7392,-104.9903",
"Colorado Springs":"38.8339,-104.8214",
"Aurora":"39.7294,-104.8319",
"Fort Collins":"40.5853,-105.0844",
"Lakewood":"39.7047,-105.0814",
"Aspen":"39.1911,-106.8175",
"Boulder":"40.01499,-105.27055",
"Breckenridge":"39.4817,-106.0384",
"Durango":"37.2753,-107.8801",
"Glenwood Springs":"39.5505,-107.3248",
"Grand Junction":"39.0639,-108.5506",
"Longmont":"40.1672,-105.1019",
"Loveland":"40.3978,-105.07498",
"Pueblo":"38.2544,-104.6091",
"Steamboat Springs":"40.48498,-106.8317",
"Telluride":"37.9375,-107.8123",
"Vail":"39.6403,-106.3742",
"Winter Park":"39.8917,-105.7631"
},

UT:{
"Salt Lake City":"40.7608,-111.8910",
"Provo":"40.2338,-111.6585",
"Orem":"40.2969,-111.6946",
"Ogden":"41.2230,-111.9738",
"Park City":"40.6461,-111.4980",
"Heber City":"40.5069,-111.4132",
"Logan":"41.7370,-111.8338",
"St George":"37.0965,-113.5684",
"Cedar City":"37.6775,-113.0619",
"Moab":"38.5733,-109.5498",
"Price":"39.5994,-110.8107",
"Vernal":"40.4555,-109.5287"
},
  
WY:{
"Casper":"42.8666,-106.3131",
"Cheyenne":"41.1400,-104.8202",
"Cody":"44.5263,-109.0565",
"Evanston":"41.2683,-110.9632",
"Gillette":"44.2911,-105.5022",
"Jackson":"43.4799,-110.7624",
"Laramie":"41.3114,-105.5911",
"Riverton":"43.0240,-108.3801",
"Rock Springs":"41.5875,-109.2029",
"Sheridan":"44.7972,-106.9562"
},
  
MT:{
"Billings":"45.7833,-108.5007",
"Bozeman":"45.6770,-111.0429",
"Butte":"46.0038,-112.5348",
"Great Falls":"47.5053,-111.3008",
"Havre":"48.5497,-109.6841",
"Helena":"46.5884,-112.0245",
"Kalispell":"48.1919,-114.3168",
"Miles City":"46.4083,-105.8406",
"Missoula":"46.8721,-113.9940",
"Whitefish":"48.4111,-114.3375"
},

ND:{
"Bismarck":"46.8083,-100.7837",
"Devils Lake":"48.1128,-98.8651",
"Dickinson":"46.8792,-102.7896",
"Fargo":"46.8772,-96.7898",
"Grand Forks":"47.9253,-97.0329",
"Jamestown":"46.9105,-98.7084",
"Minot":"48.2325,-101.2963",
"Williston":"48.1469,-103.6170"
},
  
SD:{
"Aberdeen":"45.4647,-98.4865",
"Brookings":"44.3114,-96.7984",
"Mitchell":"43.7094,-98.0298",
"Pierre":"44.3683,-100.3510",
"Rapid City":"44.0805,-103.2310",
"Sioux Falls":"43.5446,-96.7311",
"Watertown":"44.8994,-97.1151",
"Yankton":"42.8711,-97.3973"
},

NE:{
"Grand Island":"40.9264,-98.3420",
"Hastings":"40.5863,-98.3887",
"Kearney":"40.6995,-99.0815",
"Lincoln":"40.8136,-96.7026",
"Norfolk":"42.0280,-97.4170",
"North Platte":"41.1403,-100.7601",
"Omaha":"41.2565,-95.9345",
"Scottsbluff":"41.8666,-103.6672"
},

IA:{
"Ames":"42.0308,-93.6319",
"Cedar Rapids":"41.9779,-91.6656",
"Council Bluffs":"41.2619,-95.8608",
"Davenport":"41.5236,-90.5776",
"Des Moines":"41.5868,-93.6250",
"Dubuque":"42.5006,-90.6646",
"Sioux City":"42.4990,-96.4003",
"Waterloo":"42.4928,-92.3426"
},

MO:{
"Cape Girardeau":"37.3059,-89.5181",
"Columbia":"38.9517,-92.3341",
"Jefferson City":"38.5767,-92.1735",
"Joplin":"37.0842,-94.5133",
"Kansas City":"39.0997,-94.5786",
"Springfield":"37.2089,-93.2923",
"St Joseph":"39.7675,-94.8467",
"St Louis":"38.6270,-90.1994"
},

WI:{
"Appleton":"44.2619,-88.4154",
"Eau Claire":"44.8113,-91.4985",
"Green Bay":"44.5133,-88.0133",
"Kenosha":"42.5847,-87.8212",
"La Crosse":"43.8014,-91.2396",
"Madison":"43.0731,-89.4012",
"Milwaukee":"43.0389,-87.9065",
"Wausau":"44.9591,-89.6301"
},

MN:{
"Bemidji":"47.4736,-94.8803",
"Duluth":"46.7867,-92.1005",
"Mankato":"44.1636,-93.9994",
"Minneapolis":"44.9778,-93.2650",
"Moorhead":"46.8739,-96.7678",
"Rochester":"44.0121,-92.4802",
"St Cloud":"45.5579,-94.1632",
"St Paul":"44.9537,-93.0900"
},

IL:{
"Chicago":"41.8781,-87.6298",
"Peoria":"40.6936,-89.5889",
"Springfield":"39.7817,-89.6501",
"Champaign":"40.1164,-88.2434"
},

IN:{
"Indianapolis":"39.7684,-86.1581",
"Fort Wayne":"41.0793,-85.1394",
"Evansville":"37.9716,-87.5711",
"South Bend":"41.6764,-86.2520"
},

MI:{
"Detroit":"42.3314,-83.0458",
"Grand Rapids":"42.9634,-85.6681",
"Lansing":"42.7325,-84.5555",
"Traverse City":"44.7631,-85.6206"
},

OH:{
"Columbus":"39.9612,-82.9988",
"Cleveland":"41.4993,-81.6944",
"Cincinnati":"39.1031,-84.5120",
"Toledo":"41.6528,-83.5379"
},

KY:{
"Louisville":"38.2527,-85.7585",
"Lexington":"38.0406,-84.5037",
"Bowling Green":"36.9685,-86.4808"
},

TN:{
"Nashville":"36.1627,-86.7816",
"Memphis":"35.1495,-90.0490",
"Knoxville":"35.9606,-83.9207",
"Chattanooga":"35.0456,-85.3097"
},

AR:{
"Little Rock":"34.7465,-92.2896",
"Fayetteville":"36.0822,-94.1719"
},

LA:{
"New Orleans":"29.9511,-90.0715",
"Baton Rouge":"30.4515,-91.1871",
"Shreveport":"32.5252,-93.7502",
"Lafayette":"30.2241,-92.0198"
},

MS:{
"Jackson":"32.2988,-90.1848",
"Gulfport":"30.3674,-89.0928"
},

AL:{
"Birmingham":"33.5186,-86.8104",
"Huntsville":"34.7304,-86.5861",
"Mobile":"30.6954,-88.0399"
},

SC:{
"Charleston":"32.7765,-79.9311",
"Columbia":"34.0007,-81.0348",
"Greenville":"34.8526,-82.3940"
},

NC:{
"Charlotte":"35.2271,-80.8431",
"Raleigh":"35.7796,-78.6382",
"Asheville":"35.5951,-82.5515",
"Wilmington":"34.2257,-77.9447"
},

VA:{
"Richmond":"37.5407,-77.4360",
"Norfolk":"36.8508,-76.2859",
"Roanoke":"37.2709,-79.9414"
},

WV:{
"Charleston":"38.3498,-81.6326",
"Morgantown":"39.6295,-79.9559"
},

PA:{
"Philadelphia":"39.9526,-75.1652",
"Pittsburgh":"40.4406,-79.9959",
"State College":"40.7934,-77.8600"
},

NJ:{
"Newark":"40.7357,-74.1724",
"Atlantic City":"39.3643,-74.4229"
},

MD:{
"Baltimore":"39.2904,-76.6122",
"Annapolis":"38.9784,-76.4922"
},

DE:{
"Wilmington":"39.7391,-75.5398"
},

CT:{
"Hartford":"41.7658,-72.6734"
},

RI:{
"Providence":"41.8240,-71.4128"
},

MA:{
"Boston":"42.3601,-71.0589",
"Worcester":"42.2626,-71.8023"
},

VT:{
"Burlington":"44.4759,-73.2121"
},

NH:{
"Concord":"43.2081,-71.5376"
},

ME:{
"Portland":"43.6591,-70.2568"
},
  
  
FL:{ "Jacksonville":"30.3322,-81.6557","Miami":"25.7617,-80.1918","Tampa":"27.9506,-82.4572","Orlando":"28.5383,-81.3792","St Petersburg":"27.7676,-82.6403"},
GA:{ "Atlanta":"33.7490,-84.3880","Augusta":"33.4735,-82.0105","Columbus":"32.4609,-84.9877","Savannah":"32.0809,-81.0912","Macon":"32.8407,-83.6324"},
IL:{ "Chicago":"41.8781,-87.6298","Aurora":"41.7606,-88.3201","Naperville":"41.7508,-88.1535","Joliet":"41.5250,-88.0817","Rockford":"42.2711,-89.0940"},
NY:{ 
"New York":"40.7128,-74.0060",
"Buffalo":"42.8864,-78.8784",
"Rochester":"43.1566,-77.6088",
"Yonkers":"40.9312,-73.8988",
"Syracuse":"43.0481,-76.1474",
"Albany":"42.6526,-73.7562",
"Schenectady":"42.8142,-73.9396",
"Troy":"42.7284,-73.6918",
"Poughkeepsie":"41.7004,-73.9210",
"Newburgh":"41.5034,-74.0104",
"Middletown":"41.4459,-74.4229",
"Kingston":"41.9270,-73.9974",
"White Plains":"41.0330,-73.7629",
"Mount Vernon":"40.9126,-73.8371",
"New Rochelle":"40.9115,-73.7824",
"Hempstead":"40.7062,-73.6187",
"Islip":"40.7298,-73.2104",
"Patchogue":"40.7657,-73.0151",
"Ithaca":"42.4439,-76.5019",
"Binghamton":"42.0987,-75.9180",
"Elmira":"42.0898,-76.8077",
"Watertown":"43.9748,-75.9108",
"Plattsburgh":"44.6995,-73.4529"
},

  

TX:{
"Abilene":"32.4487,-99.7331",
"Amarillo":"35.221997,-101.831297",
"Austin":"30.2672,-97.7431",
"Beaumont":"30.0802,-94.1266",
"Brownsville":"25.9017,-97.4975",
"Bryan":"30.6744,-96.3698",
"College Station":"30.6279,-96.3344",
"Corpus Christi":"27.8006,-97.3964",
"Dallas":"32.7767,-96.7970",
"El Paso":"31.7619,-106.4850",
"Fort Worth":"32.7555,-97.3308",
"Galveston":"29.3013,-94.7977",
"Houston":"29.7604,-95.3698",
"Laredo":"27.5306,-99.4803",
"Longview":"32.5007,-94.7405",
"Lubbock":"33.5779,-101.8552",
"McAllen":"26.2034,-98.2300",
"Midland":"31.9973,-102.0779",
"Odessa":"31.8457,-102.3676",
"San Angelo":"31.4638,-100.4370",
"San Antonio":"29.4241,-98.4936",
"Texarkana":"33.4251,-94.0477",
"Tyler":"32.3513,-95.3011",
"Waco":"31.5493,-97.1467",
"Wichita Falls":"33.9137,-98.4934"
},


};




forecastStateSelect.innerHTML='<option value="">Select State</option>';

Object.keys(FORECAST_POINTS)
  .sort()
  .forEach(s=>{
    forecastStateSelect.innerHTML+=`<option value="${s}">${s}</option>`;
  });


// populate cities
forecastStateSelect.addEventListener("change",()=>{

 citySelect.innerHTML='<option value="">Select City</option>';
 const cities=FORECAST_POINTS[forecastStateSelect.value];

 if(!cities) return;
 Object.entries(cities).sort((a,b)=>a[0].localeCompare(b[0])).forEach(([n,v])=>{
   citySelect.innerHTML+=`<option value="${v}">${n}</option>`;
 });
});

let lat="45.5152";
let lon="-122.6784";



citySelect.addEventListener("change",()=>{

 if(!citySelect.value) return;

 [lat,lon]=citySelect.value.split(",");

 fetchForecast();

});






async function fetchForecast(){
 try{
 grid.innerHTML='<div class="loader">Loadingâ€¦</div>';
 hourlyWrap.style.display="none";
 hourRail.innerHTML="";

 const p=await fetch(`https://api.weather.gov/points/${lat},${lon}`);
 const pj=await p.json();
   // ===== NEXT 12 HOURS (NWS ONLY) =====
const hourlyResp = await fetch(pj.properties.forecastHourly);
const hourlyJSON = await hourlyResp.json();

const nextTemps = hourlyJSON.properties.periods
  .slice(0,12)
  .map(h => h.temperature);
// ---- Set City Label + Elevation ----
const cityName =
  citySelect.options[citySelect.selectedIndex]?.text || "Selected City";

const meters = pj.properties.elevation?.value;
const feet = meters != null ? Math.round(meters * 3.28084) : null;

document.getElementById("forecastCityLabel").textContent =
  feet ? `${cityName} (Elev. ${feet} ft)` : cityName;

 const fr=await fetch(pj.properties.forecast);
 const fj=await fr.json();

 const hr=await fetch(pj.properties.forecastHourly);
 const hj=await hr.json();

const periods = fj.properties.periods;

// grab daytime entries only
const daytime = periods.filter(p => p.isDaytime).slice(0,7);

grid.innerHTML="";

daytime.forEach((d,i)=>{
// --- Snow amount extraction ---
let snowText = "";

if(d.detailedForecast && d.detailedForecast.toLowerCase().includes("snow")){

  const match = d.detailedForecast.match(/snow accumulation[^.]*\./i);

  if(match){
    snowText = match[0];
  } else {
    snowText = "Snow possible";
  }
}

  const night = periods[periods.indexOf(d)+1];

  const hi = d.temperature;
  const lo = night?.temperature ?? "â€”";

  const c=document.createElement("div");
  c.className="fc-card";

const wind = d.windSpeed || "â€”";
const gust = d.windGust ? ` / Gust ${d.windGust}` : "";

c.innerHTML=`
  <div class="fc-day">${d.name}</div>

  <div class="fc-icon">
    <img src="${d.icon}">
  </div>

  <div class="fc-temp">
    <span class="hi">${hi}Â°</span>
    <span class="lo">${lo}Â°</span>
  </div>

  <div class="fc-desc">${d.shortForecast}</div>

  ${snowText ? `<div class="fc-snow">${snowText}</div>` : ""}

  <div class="fc-wind">
    Wind ${wind}${gust}
  </div>
`;


  grid.appendChild(c);
});





 hourlyWrap.style.display="flex";
(hj.properties?.periods || []).slice(0,24).forEach(h=>{

  const el=document.createElement("div");
  el.className="hour-card";

  const hour = new Date(h.startTime).toLocaleTimeString([], {
    hour: "numeric"
  });

  const wind = h.windSpeed || "â€”";
  const dir = h.windDirection || "";

const pop = h.probabilityOfPrecipitation?.value;
const precip = pop != null ? `${pop}%` : "â€”";

el.innerHTML = `
  <div>${hour}</div>

  <img src="${h.icon}">

  <div class="hour-temp">${h.temperature}Â°</div>

  <div class="hour-wind">${wind} ${dir}</div>

  <div class="hour-pop">${precip} ${h.shortForecast}</div>
`;


  hourRail.appendChild(el);

});


 tsEl.textContent="Updated "+new Date().toLocaleTimeString();

 }catch(e){
  console.error(e);
  grid.innerHTML="Forecast unavailable";
 }
}



// Default to Portland on load
lat = "45.5152";
lon = "-122.6784";

// visually select Portland in dropdown if present
[...citySelect.options].forEach(o=>{
  if(o.text==="Portland") o.selected=true;
});


// ===== DEFAULT PORTLAND ON LOAD (STATE + CITY) =====
function selectDefaultPortland(){

  const trySelect = setInterval(()=>{

    if(forecastStateSelect.options.length > 1){

      forecastStateSelect.value = "OR";
      forecastStateSelect.dispatchEvent(new Event("change"));

      setTimeout(()=>{

        [...citySelect.options].forEach(o=>{
          if(o.text === "Portland"){
            o.selected = true;
            citySelect.dispatchEvent(new Event("change"));
            clearInterval(trySelect);
          }
        });

      },150);

    }

  },200);

}


selectDefaultPortland();




refreshBtn.onclick=fetchForecast;




})();


</script>




</div> <!-- last panel / content -->

<div class="footer">
  <div class="social-bar">
    <a class="ig" href="https://www.instagram.com/iloveweather/" target="_blank">â—Ž</a>
    <a class="fb" href="https://www.facebook.com/WeatherJefe/" target="_blank">f</a>
    <a class="th" href="https://www.threads.com/@iloveweather" target="_blank">@</a>
    <a class="in" href="https://www.linkedin.com/in/jeff-forgeron-447ab846" target="_blank">in</a>
  </div>
</div>
<script>
const burger=document.getElementById("hamburgerMenu");
const dropdown=document.getElementById("menuDropdown");

burger.onclick=()=>{
 dropdown.style.display=
 dropdown.style.display==="block"?"none":"block";
};

document.addEventListener("click",e=>{
 if(!burger.contains(e.target)){
  dropdown.style.display="none";
 }
});
</script>

</body>




</html>
