<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Jeff Forgeron’s Weather Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body {
  font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
  margin: 20px;
  background: #1f2933;
  color: #f9fafb;
  position: relative;
}

/* ===== TEMP TICKER ===== */
.city-list {
  position: absolute;
  top: 14px;
  left: 14px;
  width: 360px;
  background: rgba(0,0,0,0.65);
  color: #e5e7eb;
  font-size: 12px;
  padding: 6px 0;
  border-radius: 8px;
  z-index: 10;
  overflow: hidden;
}

.city-track {
  display: inline-flex;
  white-space: nowrap;
  animation: cityScroll 40s linear infinite;
}

.city-item {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 0 14px;
}

.city-temp { font-weight: 600; }

@keyframes cityScroll {
  from { transform: translateX(0); }
  to { transform: translateX(-50%); }
}

/* ===== CLOCKS ===== */
.time-bar {
  position: absolute;
  top: 10px;
  right: 10px;
  display: flex;
  gap: 6px;
  z-index: 10;
  font-family: ui-monospace, monospace;
}

.time-pill {
  background: rgba(0,0,0,0.6);
  color: #e5e7eb;
  padding: 4px 7px;
  border-radius: 7px;
  font-size: 10px;
  min-width: 52px;
  text-align: center;
}

.time-pill span {
  display: block;
  font-size: 8px;
  opacity: 0.65;
}

/* ===== LAYOUT ===== */
h1 {
  text-align: center;
  margin-top: 60px;
  margin-bottom: 26px;
}

.top-row {
  display: flex;
  gap: 16px;
  flex-wrap: wrap;
}

.panel {
  flex: 1 1 480px;
  background: #e5e7eb;
  border-radius: 10px;
  color: #111;
  display: flex;
  flex-direction: column;
}

.panel.full {
  flex: 1 1 100%;
  margin-top: 22px;
}

.panel-title {
  padding: 10px 12px;
  font-weight: 600;
  background: #dde1e6;
}

.image-box {
  height: 440px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: #dfe3e8;
}

.image-box img {
  max-width: 100%;
  max-height: 100%;
}

.controls {
  padding: 10px;
  background: #e9ebee;
  display: flex;
  gap: 8px;
  flex-wrap: wrap;
  font-size: 13px;
}

select { font-size: 13px; }
</style>
</head>

<body>

<!-- ===== TEMP TICKER ===== -->
<div class="city-list">
  <div class="city-track">
    <div class="city-item" data-station="KSEA">Seattle <span class="city-temp">--</span></div>
    <div class="city-item" data-station="KPDX">Portland <span class="city-temp">--</span></div>
    <div class="city-item" data-station="KSFO">San Francisco <span class="city-temp">--</span></div>
    <div class="city-item" data-station="KLAX">Los Angeles <span class="city-temp">--</span></div>
    <div class="city-item" data-station="KSAN">San Diego <span class="city-temp">--</span></div>

    <!-- duplicate for seamless loop -->
    <div class="city-item" data-station="KSEA">Seattle <span class="city-temp">--</span></div>
    <div class="city-item" data-station="KPDX">Portland <span class="city-temp">--</span></div>
    <div class="city-item" data-station="KSFO">San Francisco <span class="city-temp">--</span></div>
    <div class="city-item" data-station="KLAX">Los Angeles <span class="city-temp">--</span></div>
    <div class="city-item" data-station="KSAN">San Diego <span class="city-temp">--</span></div>
  </div>
</div>

<!-- ===== CLOCKS ===== -->
<div class="time-bar" id="timeBar"></div>

<h1>Jeff Forgeron’s Weather Dashboard</h1>

<div class="top-row">

<!-- ===== SATELLITE ===== -->
<div class="panel">
  <div class="panel-title">Satellite</div>

  <a id="satLink" target="_blank">
    <div class="image-box">
      <img id="satImage"
        src="https://cdn.star.nesdis.noaa.gov/GOES18/ABI/SECTOR/pnw/GEOCOLOR/latest.jpg"
        alt="Satellite imagery">
    </div>
  </a>

  <div class="controls">
    Region:
    <select id="satRegion" onchange="updateSatellite()">
      <!-- GOES-WEST -->
      <option value="pnw">Pacific Northwest (G18)</option>
      <option value="wus">West U.S. (G18)</option>
      <option value="psw">Southwest U.S. (G18)</option>
      <option value="gwas">CONUS (G18)</option>

      <!-- GOES-EAST -->
      <option value="eus">East U.S. (G19)</option>
      <option value="nr">Northern Rockies (G19)</option>
      <option value="sr">Southern Rockies (G19)</option>
      <option value="sp">Southern Plains (G19)</option>
      <option value="can">Canada & Northern U.S. (G19)</option>
      <option value="umv">Upper Mississippi Valley (G19)</option>
      <option value="smv">Lower Mississippi Valley (G19)</option>
      <option value="cgl">Great Lakes (G19)</option>
      <option value="ne">Northeast (G19)</option>
    </select>
  </div>
</div>

<!-- ===== RADAR ===== -->
<div class="panel">
  <div class="panel-title">Radar</div>

  <div class="image-box">
    <img id="radarImage"
      src="https://radar.weather.gov/ridge/standard/PACNORTHWEST_loop.gif"
      alt="Radar loop">
  </div>

  <div class="controls">
    Region:
    <select id="regionSelect"></select>

    State:
    <select id="stateSelect"></select>

    City:
    <select id="radarSelect"></select>
  </div>
</div>

</div>

<!-- ===== CURRENT TEMPERATURES PANEL (RESTORED) ===== -->
<div class="panel full">
  <div class="panel-title">Current Temperatures</div>

  <a href="https://viewer.weather.noaa.gov/general#layers=3+42853+42379&panel=layer"
     target="_blank">
    <div class="image-box" style="height:auto;padding:12px;">
      <img
        src="https://www.wpc.ncep.noaa.gov/sfc/90fwbg.gif"
        alt="Current U.S. Temperatures">
    </div>
  </a>
</div>

<script>
/* ===== CLOCKS ===== */
function updateTimes() {
  const now = new Date();
  const fmt = tz => now.toLocaleTimeString("en-US", {
    timeZone: tz, hour: "2-digit", minute: "2-digit", second: "2-digit", hour12: false
  });

  timeBar.innerHTML = `
    <div class="time-pill"><span>PT</span>${fmt("America/Los_Angeles")}</div>
    <div class="time-pill"><span>MT</span>${fmt("America/Denver")}</div>
    <div class="time-pill"><span>CT</span>${fmt("America/Chicago")}</div>
    <div class="time-pill"><span>ET</span>${fmt("America/New_York")}</div>
    <div class="time-pill"><span>UTC</span>${now.toISOString().slice(11,19)}Z</div>
  `;
}
setInterval(updateTimes, 1000);
updateTimes();

/* ===== CITY TEMPS ===== */
async function updateCityTemps() {
  document.querySelectorAll(".city-item").forEach(async item => {
    try {
      const res = await fetch(
        `https://api.weather.gov/stations/${item.dataset.station}/observations/latest`
      );
      const data = await res.json();
      const c = data.properties.temperature.value;
      item.querySelector(".city-temp").textContent =
        c == null ? "--" : Math.round(c * 9/5 + 32) + "°F";
    } catch {
      item.querySelector(".city-temp").textContent = "--";
    }
  });
}
updateCityTemps();
setInterval(updateCityTemps, 300000);

/* ===== SATELLITE LOGIC (FULLY FIXED) ===== */
function updateSatellite() {
  const r = satRegion.value;
  const east = ["eus","nr","sr","sp","can","umv","smv","cgl","ne"];

  if (east.includes(r)) {
    satImage.src =
      `https://cdn.star.nesdis.noaa.gov/GOES19/ABI/SECTOR/${r}/GEOCOLOR/latest.jpg`;
    satLink.href =
      `https://www.star.nesdis.noaa.gov/goes/sector_band.php?sat=G19&sector=${r}&band=GEOCOLOR&length=24`;
  } else {
    satImage.src = r === "gwas"
      ? "https://cdn.star.nesdis.noaa.gov/GOES18/ABI/SECTOR/gwas/GEOCOLOR/1800x1080.jpg"
      : `https://cdn.star.nesdis.noaa.gov/GOES18/ABI/SECTOR/${r}/GEOCOLOR/latest.jpg`;

    satLink.href =
      `https://www.star.nesdis.noaa.gov/goes/sector_band.php?sat=G18&sector=${r}&band=GEOCOLOR&length=24`;
  }
}

/* ===== RADAR DROPDOWNS (UNCHANGED, WORKING) ===== */
const radarRegions = {
  "CONUS": { loop: "CONUS-LARGE" },
  "Northwest": {
    loop: "PACNORTHWEST",
    states: {
      "WA": [["KATX","Seattle"],["KLGX","Langley Hill"],["KOTX","Spokane"]],
      "OR": [["KRTX","Portland"],["KMAX","Medford"]],
      "ID": [["KCBX","Boise"]],
      "MT": [["KTFX","Great Falls"],["KMSX","Missoula"]]
    }
  },
  "Southwest": {
    loop: "PACSOUTHWEST",
    states: {
      "CA": [["KMUX","San Jose"],["KHNX","Hanford"],["KSOX","Santa Ana"],["KLAX","Los Angeles"],["KNKX","San Diego"]],
      "NV": [["KRGX","Reno"],["KLRX","Elko"]],
      "AZ": [["KIWA","Phoenix"],["KEMX","Tucson"]],
      "UT": [["KICX","Cedar City"]],
      "NM": [["KABX","Albuquerque"]]
    }
  }
};

function initRadar() {
  regionSelect.innerHTML = "";
  Object.keys(radarRegions).forEach(r =>
    regionSelect.innerHTML += `<option value="${r}">${r}</option>`
  );
  regionSelect.value = "Northwest";
  handleRadarRegion();
}

function handleRadarRegion() {
  const r = radarRegions[regionSelect.value];

  if (regionSelect.value === "CONUS") {
    radarImage.src =
      "https://radar.weather.gov/ridge/standard/CONUS-LARGE_loop.gif";
    stateSelect.innerHTML = "";
    radarSelect.innerHTML = "";
    return;
  }

  radarImage.src =
    `https://radar.weather.gov/ridge/standard/${r.loop}_loop.gif`;

  stateSelect.innerHTML = `<option value="">Select State</option>`;
  radarSelect.innerHTML = "";

  Object.keys(r.states).forEach(s =>
    stateSelect.innerHTML += `<option value="${s}">${s}</option>`
  );
}

function populateRadarSites() {
  radarSelect.innerHTML = `<option value="">Select City</option>`;
  if (!stateSelect.value) return;

  radarRegions[regionSelect.value].states[stateSelect.value]
    .forEach(site =>
      radarSelect.innerHTML +=
        `<option value="${site[0]}">${site[1]}</option>`
    );
}

function changeRadar() {
  if (!radarSelect.value) return;
  radarImage.src =
    `https://radar.weather.gov/ridge/standard/${radarSelect.value}_loop.gif`;
}

regionSelect.onchange = handleRadarRegion;
stateSelect.onchange = populateRadarSites;
radarSelect.onchange = changeRadar;

initRadar();
updateSatellite();
</script>

</body>
</html>
