<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Jeff Forgeron’s Weather Desk</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

<style>
body {
  font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
  margin: 20px;
  background: #1f2933;
  color: #f9fafb;
  position: relative;
  /* ===== DESKTOP DASHBOARD COLUMNS ===== */
.column {
  display: flex;
  flex-direction: column;
  gap: 16px;
  flex: 1 1 480px;
}
/* ===== FORCE TWO-COLUMN DESKTOP LAYOUT ===== */
@media (min-width: 769px) {
  .top-row {
    flex-wrap: nowrap;
  }
}
/* ===== DESKTOP PANEL ORDER ===== */
.top-row .panel:nth-child(1){ order:4; } /* Satellite -> bottom right */
.top-row .panel:nth-child(2){ order:2; } /* Radar -> top right */
.top-row .panel:nth-child(3){ order:1; } /* Current -> top left */
.top-row .panel:nth-child(4){ order:3; } /* Forecast -> bottom left */

}

/* ================= CITY TEMP TICKER ================= */
.city-list {
  position: absolute;
  top: 14px;
  left: 14px;
  width: 360px;
  background: rgba(0,0,0,0.65);
  color: #e5e7eb;
  font-size: 12px;
  padding: 6px 0;
  border-radius: 8px;
  z-index: 10;
  overflow: hidden;
}

.city-track {
  display: inline-flex;
  white-space: nowrap;
  animation: cityScroll 40s linear infinite;
}

.city-item {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 0 14px;
}

.city-temp { font-weight: 600; }

@keyframes cityScroll {
  from { transform: translateX(0); }
  to { transform: translateX(-50%); }
}

/* ================= CLOCKS ================= */
.time-bar {
  position: absolute;
  top: 10px;
  right: 10px;
  display: flex;
  gap: 5px;
  z-index: 10;
  font-family: ui-monospace, monospace;
}

.time-pill {
  background: rgba(0,0,0,0.6);
  color: #e5e7eb;
  padding: 4px 6px;
  border-radius: 7px;
  font-size: 10px;
  letter-spacing: 0.6px;
  min-width: 48px;
  text-align: center;
}

.time-pill span {
  display: block;
  font-size: 8px;
  opacity: 0.65;
  margin-bottom: 1px;
}

/* ================= LAYOUT ================= */
h1 {
  text-align: center;
  margin-top: 60px;
  margin-bottom: 6px;
}

.subtitle {
  text-align: center;
  color: #9ca3af;
  margin-bottom: 26px;
}

.top-row {
  display: flex;
  gap: 16px;
  flex-wrap: wrap;
}

.panel {
  flex: 1 1 480px;
  background: #e5e7eb;
  border-radius: 10px;
  display: flex;
  flex-direction: column;
  color: #111;
}

.panel.full {
  flex: 1 1 100%;
  margin-top: 20px;
}

.panel-title {
  padding: 10px 12px;
  font-weight: 600;
  background: #dde1e6;
}

.image-box {
  height: 440px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: #dfe3e8;
}

.image-box img {
  max-width: 100%;
  max-height: 100%;
}

.controls {
  padding: 10px;
  background: #e9ebee;
  display: flex;
  gap: 8px;
  flex-wrap: wrap;
  font-size: 13px;
}

select { font-size: 13px; }
/* ===== MOBILE FIX: SAFE PHASE 1 OVERRIDES ===== */
@media (max-width: 768px) {

  body {
    margin: 10px;
  }
/* ===== MOBILE PANEL ORDER ===== */

.top-row .panel:nth-child(1){ order:4; } /* Satellite -> last */
.top-row .panel:nth-child(2){ order:1; } /* Radar -> first */
.top-row .panel:nth-child(3){ order:2; } /* Current Conditions */
.top-row .panel:nth-child(4){ order:3; } /* Forecast Tools */

/* Feels Like interaction styling */
#feelsToggle {
  cursor: pointer;
  transition: color 0.2s ease, opacity 0.2s ease;
}

#feelsToggle:hover {
  color: #38bdf8;
  opacity: 1;
  text-decoration: underline;
}

#feelsToggle.active {
  color: #38bdf8;
  text-decoration: underline;
}

  
  /* Move ticker + clocks into normal flow */
  .city-list {
    position: static;
    width: 100%;
    margin-bottom: 8px;
  }

  .time-bar {
    position: static;
    justify-content: center;
    margin-bottom: 10px;
  }

  /* Reduce header size */
  h1 {
    margin-top: 10px;
    font-size: 22px;
  }

  .subtitle {
    font-size: 13px;
    margin-bottom: 16px;
  }

  /* Stack Satellite + Radar */
  .top-row {
    flex-direction: column;
  }

  .panel {
    flex: 1 1 100%;
  }

  /* Make images fit phone screens */
  .image-box {
    height: auto;
    min-height: 220px;
    max-height: 60vh;
  }

  /* Make controls easier to tap */
  .controls {
    font-size: 14px;
    gap: 10px;
  }

  select {
    font-size: 14px;
    padding: 4px;
  }
}
/* ===== DESKTOP 2x2 DASHBOARD GRID ===== */
@media (min-width: 769px) {
  .top-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 16px;
  }

  .panel {
    width: 100%;
  }
}
/* ===== CLEAN FOOTER + SOCIAL ICONS ===== */

.footer {
  margin-top: 32px;
  padding-bottom: 20px;
  background: transparent;
  display: flex;
  justify-content: center;
}

.social-bar {
  display: flex;
  gap: 18px;
  padding: 10px 14px;
  background: #0b1220;
  border-radius: 10px;
}

.social-bar a {
  width: 22px;
  height: 22px;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  font-family: ui-monospace, system-ui, sans-serif;
  font-size: 13px;
  font-weight: 600;
  text-decoration: none;
  color: #9ca3af;
  border: 1px solid rgba(255,255,255,0.15);
  border-radius: 6px;
  transition: color 0.2s ease, border-color 0.2s ease, transform 0.2s ease;
}

.social-bar a:hover {
  color: #38bdf8;
  border-color: #38bdf8;
  transform: translateY(-2px);
}

/* ===== FORECAST TV (sleek) ===== */
.forecast-tv {
  padding: 12px;
  display: flex;
  flex-direction: column;
  gap: 10px;
  background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.03));
  border-radius: 8px;
  min-height: 220px;
  color: var(--text-primary, #e5e7eb);
}

.forecast-header {
  display:flex;
  align-items:center;
  gap:12px;
  justify-content: space-between;
  color: var(--text-secondary,#cbd5e1);
  font-size:13px;
}

.forecast-header .city {
  font-weight:700;
  font-size:14px;
  color: var(--text-primary,#f1f5f9);
}

.refresh {
  cursor:pointer;
  opacity:0.7;
  padding:6px;
  border-radius:6px;
  transition: all .15s ease;
}
.refresh:hover { color: #38bdf8; transform: translateY(-2px); opacity:1; }

.forecast-grid {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  gap: 8px;
  width: 100%;
}

/* responsive: stack on small screens */
@media (max-width: 768px) {
  .forecast-grid { grid-template-columns: repeat(2, 1fr); }
}

/* forecast card */
.fc-card {
  background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  border: 1px solid rgba(255,255,255,0.04);
  border-radius: 8px;
  padding: 8px;
  display:flex;
  flex-direction: column;
  gap:6px;
  align-items:center;
  justify-content:space-between;
  min-height:110px;
  transition: transform .18s ease, box-shadow .18s ease;
}
.fc-card:hover {
  transform: translateY(-6px);
  box-shadow: 0 10px 30px rgba(2,6,23,0.45);
}

.fc-day {
  font-weight:700;
  font-size:13px;
  color: #f1f5f9;
  text-align:center;
}

.fc-icon {
  width:48px;
  height:48px;
  background: rgba(255,255,255,0.03);
  border-radius:8px;
  display:flex;
  align-items:center;
  justify-content:center;
  overflow:hidden;
}

.fc-icon img { width:100%; height:100%; object-fit:contain; filter: drop-shadow(0 2px 6px rgba(0,0,0,0.6)); }

.fc-temp {
  font-weight:800;
  font-size:16px;
  color: #fff;
  display:flex;
  gap:8px;
  align-items:center;
}

.fc-temp .hi { color: #ffd166; }  /* warm */
.fc-temp .lo { color: #9ad1ff; }  /* cool */

.fc-desc {
  font-size:11px;
  color: var(--text-secondary,#cbd5e1);
  text-align:center;
  line-height:1.1;
}

/* loader */
.loader {
  text-align:center;
  width:100%;
  color:var(--text-secondary,#9ca3af);
  padding:18px 0;
}

/* timestamp footer */
.forecast-footer { display:flex; justify-content:flex-end; }
.forecast-footer .ts { font-size:11px; color:var(--text-secondary,#9ca3af); }

/* ===== FORECAST READABILITY BOOST ===== */

/* Darken card background */
.fc-card {
  background: #0b1220;
  border: 1px solid rgba(255,255,255,0.08);
}

/* Make day labels brighter */
.fc-day {
  color: #ffffff;
}

/* Stronger temps */
.fc-temp {
  color: #ffffff;
}

.fc-temp .hi {
  color: #facc15; /* warm yellow */
}

.fc-temp .lo {
  color: #60a5fa; /* cool blue */
}

/* Description text clearer */
.fc-desc {
  color: #cbd5e1;
}

/* Header text */
.forecast-header .city {
  color: #38bdf8;      /* dashboard accent blue */
  font-weight: 800;
  letter-spacing: 0.3px;
}

}

.forecast-header .meta {
  color: #9ca3af;
}

/* Icon container darker */
.fc-icon {
  background: #020617;
}

/* Forecast header darker, more subtle */
.forecast-header .city,
.forecast-header .meta {
  color: #9ca3af;   /* dark gray */
  font-weight: 600;
}
/* Forecast city dropdown styling */
#forecastCitySelect {
  background: #020617;
  color: #9ca3af;
  border: 1px solid rgba(255,255,255,0.1);
  border-radius: 6px;
  padding: 4px 6px;
  font-size: 12px;
}
/* ===== CURRENT CONDITIONS PRO CARD ===== */

.cc-header{
  display:flex;
  justify-content:space-between;
  margin-bottom:8px;
}

.cc-city{
  font-weight:700;
  color:#e5e7eb;
}

.cc-updated{
  font-size:11px;
  color:#9ca3af;
}

.cc-main{
  display:grid;
  grid-template-columns:2fr 1fr;
  gap:14px;
}

.cc-temp{
  font-size:56px;
  font-weight:900;
  color:#fff;
  animation:pulse 2.5s infinite;
}

.cc-feels{
  color:#9ca3af;
  margin-bottom:6px;
}

.cc-left canvas{
  width:100%;
}

.cc-right{
  display:flex;
  flex-direction:column;
  gap:6px;
  font-size:13px;
  color:#cbd5e1;
}

@keyframes pulse{
  0%{opacity:1}
  50%{opacity:.65}
  100%{opacity:1}
}
/* ===== CURRENT CONDITIONS PRO UI ===== */

#ccCityWrap{
  background: radial-gradient(circle at top,#0f172a,#020617);
  border-radius:10px;
  color:#e5e7eb;
}

.cc-main{
  grid-template-columns:1.5fr 1fr;
}

.cc-temp{
  font-size:64px;
  background:linear-gradient(90deg,#38bdf8,#facc15);
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
}

.cc-left{
  display:flex;
  flex-direction:column;
  gap:6px;
}

#ccChart{
  margin-top:8px;
}

.cc-right{
  background:#020617;
  border-radius:8px;
  padding:10px;
}

.cc-right div{
  background:#0b1220;
  padding:6px 8px;
  border-radius:6px;
  font-size:12px;
}

.cc-header{
  margin-bottom:10px;
}

.cc-city{
  font-size:15px;
  font-weight:800;
  letter-spacing:.4px;
}

.cc-updated{
  opacity:.6;
}

/* Glow chart */
canvas{
  filter:drop-shadow(0 0 6px rgba(56,189,248,.6));
}
/* ===== SPACE NEON CURRENT CONDITIONS ===== */

#ccCityWrap{
  background:
    radial-gradient(circle at 20% 10%, #1e293b 0%, transparent 40%),
    radial-gradient(circle at 80% 30%, #0ea5e9 0%, transparent 45%),
    radial-gradient(circle at 50% 80%, #9333ea 0%, transparent 50%),
    linear-gradient(#020617,#020617);
}

.cc-left{
  padding-right:6px;
}

.cc-right div{
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.cc-right div span{
  color:#38bdf8;
  font-weight:600;
}

/* Axis labels */
.chart-title{
  font-size:12px;
  opacity:.7;
  margin-bottom:4px;
}

/* Neon pulse */
.cc-temp{
  text-shadow:0 0 18px rgba(56,189,248,.6);
}

/* softer chart */
canvas{
  filter:drop-shadow(0 0 10px rgba(56,189,248,.7));
}
/* ===== MOBILE PANEL ORDER ===== */
.top-row .panel:nth-child(1){ order:4; } /* Satellite */
.top-row .panel:nth-child(2){ order:3; } /* Radar */
.top-row .panel:nth-child(3){ order:1; } /* Current */
.top-row .panel:nth-child(4){ order:2; } /* Forecast */
/* ===== FORCE CURRENT CONDITIONS TO FILL PANEL HEIGHT ===== */

#ccCityWrap,
#ccMapWrap {
  flex: 1;
  display: flex;
  flex-direction: column;
}

.cc-main {
  flex: 1;
}

.cc-left,
.cc-right {
  height: 100%;
}
/* Make Current Conditions chart fill available height */

#ccChart{
  flex:1;
  width:100% !important;
  min-height:220px;
}

.cc-left{
  flex:1;
}
  
</style>
</head>

<body>


  
  
<!-- ===== CITY TEMP TICKER ===== -->
<div class="city-list">
  <div class="city-track">
    <div class="city-item" data-station="KSEA">Seattle <span class="city-temp">--</span></div>
    <div class="city-item" data-station="KPDX">Portland <span class="city-temp">--</span></div>
    <div class="city-item" data-station="KSFO">San Francisco <span class="city-temp">--</span></div>
    <div class="city-item" data-station="KLAX">Los Angeles <span class="city-temp">--</span></div>
    <div class="city-item" data-station="KSAN">San Diego <span class="city-temp">--</span></div>

    <div class="city-item" data-station="KSEA">Seattle <span class="city-temp">--</span></div>
    <div class="city-item" data-station="KPDX">Portland <span class="city-temp">--</span></div>
    <div class="city-item" data-station="KSFO">San Francisco <span class="city-temp">--</span></div>
    <div class="city-item" data-station="KLAX">Los Angeles <span class="city-temp">--</span></div>
    <div class="city-item" data-station="KSAN">San Diego <span class="city-temp">--</span></div>
  </div>
</div>

<!-- ===== CLOCKS ===== -->
<div class="time-bar" id="timeBar"></div>

<h1>Jeff Forgeron’s Weather Dashboard</h1>
<div class="subtitle">A clean, no-nonsense forecast desk.</div>

<div class="top-row">
  <!-- SATELLITE -->
  <div class="panel">
    <div class="panel-title">Satellite</div>
    <a id="satLink" target="_blank">
      <div class="image-box">
        <img id="satImage"
             src="https://cdn.star.nesdis.noaa.gov/GOES18/ABI/SECTOR/pnw/GEOCOLOR/latest.jpg">
      </div>
    </a>
    <div class="controls">
      Region:
      <select id="satRegion" onchange="updateSatellite()">
        <option value="pnw">Pacific Northwest (G18)</option>
        <option value="wus">West U.S. (G18)</option>
        <option value="psw">Southwest U.S. (G18)</option>
        <option value="gwas">CONUS (G18)</option>
        <option value="eus">East U.S. (G19)</option>
        <option value="nr">Northern Rockies (G19)</option>
        <option value="sr">Southern Rockies (G19)</option>
        <option value="sp">Southern Plains (G19)</option>
        <option value="can">Canada & Northern U.S. (G19)</option>
        <option value="umv">Upper Mississippi Valley (G19)</option>
        <option value="smv">Lower Mississippi Valley (G19)</option>
        <option value="cgl">Great Lakes (G19)</option>
        <option value="ne">Northeast (G19)</option>
      </select>
    </div>
  </div>

  <!-- RADAR -->
  <div class="panel">
    <div class="panel-title">Radar</div>
    <div class="image-box">
      <img id="radarImage"
           src="https://radar.weather.gov/ridge/standard/PACNORTHWEST_loop.gif">
    </div>
    <div class="controls">
      Region:
      <select id="regionSelect"></select>
      State:
      <select id="stateSelect"></select>
      City:
      <select id="radarSelect"></select>
    </div>
  </div>

<!-- CURRENT CONDITIONS -->
<div class="panel">

  <div class="panel-title" style="display:flex;justify-content:space-between;align-items:center;">
    <span>Current Conditions <span id="feelsToggle" style="opacity:.6;margin-left:6px;cursor:pointer;">Feels Like</span></span>

    <select id="currentCitySelect"
      style="font-size:12px;background:#020617;color:#9ca3af;border:1px solid rgba(255,255,255,.15);border-radius:6px;padding:2px 6px;">
      <option value="US" selected>United States</option>
      <option value="45.5152,-122.6784">Portland, OR</option>
      <option value="34.0522,-118.2437">Los Angeles, CA</option>
      <option value="47.6062,-122.3321">Seattle, WA</option>
      <option value="40.7128,-74.0060">New York, NY</option>
      <option value="41.8781,-87.6298">Chicago, IL</option>
      <option value="29.7604,-95.3698">Houston, TX</option>
      <option value="25.7617,-80.1918">Miami, FL</option>
      <option value="39.7392,-104.9903">Denver, CO</option>
    </select>
  </div>

  <!-- MAP MODE -->
  <div id="ccMapWrap" class="image-box" style="padding:0;">
    <img id="tempMapImage"
      src="https://data.mesonet.org/data/public/noaa/metar/maps/realtime/latest.tair.png"
      style="width:100%;height:auto;">
  </div>

  <!-- CITY MODE -->
 <div id="ccCityWrap" style="display:none;padding:14px;">

  <div class="cc-header">
    <div id="ccCity" class="cc-city"></div>
    <div id="ccUpdated" class="cc-updated"></div>
  </div>

  <div class="cc-main">

    <!-- LEFT: TEMP + CHART -->
    <div class="cc-left">
      <div id="ccTemp" class="cc-temp">—</div>
      <div id="ccFeels" class="cc-feels"></div>

      <canvas id="ccChart"></canvas>

    </div>

    <!-- RIGHT: STATS -->
    <div class="cc-right">
      <div id="ccWx"></div>
      <div id="ccWind"></div>
      <div id="ccHum"></div>
      <div id="ccDew"></div>
      <div id="ccSun"></div>
      <div id="ccUV"></div>
    </div>

  </div>

</div>


</div>







<!-- FORECAST TOOLS (7-day sleek TV style) -->
<div class="panel" id="forecastPanel">
  <div class="panel-title">Forecast Tools</div>
  <div class="forecast-tv">
    <div class="forecast-header">
  <select id="forecastCitySelect"> 
    <option value="45.5152,-122.6784" selected>Portland, OR</option>
    <option value="40.7128,-74.0060">New York, NY</option>
    <option value="34.0522,-118.2437">Los Angeles, CA</option>
    <option value="41.8781,-87.6298">Chicago, IL</option>
    <option value="29.7604,-95.3698">Houston, TX</option>
    <option value="33.4484,-112.0740">Phoenix, AZ</option>
    <option value="39.9526,-75.1652">Philadelphia, PA</option>
    <option value="29.4241,-98.4936">San Antonio, TX</option>
    <option value="32.7157,-117.1611">San Diego, CA</option>
    <option value="32.7767,-96.7970">Dallas, TX</option>
    <option value="37.3382,-121.8863">San Jose, CA</option>
    <option value="30.2672,-97.7431">Austin, TX</option>
    <option value="47.6062,-122.3321">Seattle, WA</option>
    <option value="39.7392,-104.9903">Denver, CO</option>
    <option value="38.9072,-77.0369">Washington, DC</option>
    <option value="42.3601,-71.0589">Boston, MA</option>
    <option value="25.7617,-80.1918">Miami, FL</option>
    <option value="33.7490,-84.3880">Atlanta, GA</option>
    <option value="36.1627,-86.7816">Nashville, TN</option>
    <option value="35.2271,-80.8431">Charlotte, NC</option>
  </select>

  <div class="meta">7-Day Outlook via NWS</div>
  <div class="refresh" id="forecastRefreshBtn" title="Refresh now">⟳</div>
</div>


    <div id="forecastGrid" class="forecast-grid" aria-live="polite">
      <!-- Forecast cards injected here -->
      <div class="loader">Loading…</div>
    </div>

    <div class="forecast-footer">
      <div id="forecastTimestamp" class="ts">Last updated: —</div>
    </div>
  </div>
</div>



<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>


<script>
/* ===== CLOCKS ===== */
function updateTimes(){
  const n=new Date();
  const f=tz=>n.toLocaleTimeString("en-US",{
    timeZone:tz,hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:false
  });
  timeBar.innerHTML=`
    <div class="time-pill"><span>PT</span>${f("America/Los_Angeles")}</div>
    <div class="time-pill"><span>MT</span>${f("America/Denver")}</div>
    <div class="time-pill"><span>CT</span>${f("America/Chicago")}</div>
    <div class="time-pill"><span>ET</span>${f("America/New_York")}</div>
    <div class="time-pill"><span>UTC</span>${n.toISOString().slice(11,19)}Z</div>
  `;
}
setInterval(updateTimes,1000); updateTimes();

/* ===== SATELLITE ===== */
function updateSatellite(){
  const r=satRegion.value;
  const east=["eus","nr","sr","sp","can","umv","smv","cgl","ne"];
  if(east.includes(r)){
    satImage.src=`https://cdn.star.nesdis.noaa.gov/GOES19/ABI/SECTOR/${r}/GEOCOLOR/latest.jpg`;
    satLink.href=`https://www.star.nesdis.noaa.gov/goes/sector_band.php?sat=G19&sector=${r}&band=GEOCOLOR&length=24`;
  } else {
    satImage.src=r==="gwas"
      ? "https://cdn.star.nesdis.noaa.gov/GOES18/ABI/SECTOR/gwas/GEOCOLOR/1800x1080.jpg"
      : `https://cdn.star.nesdis.noaa.gov/GOES18/ABI/SECTOR/${r}/GEOCOLOR/latest.jpg`;
    satLink.href=`https://www.star.nesdis.noaa.gov/goes/sector_band.php?sat=G18&sector=${r}&band=GEOCOLOR&length=24`;
  }
}

/* ===== RADAR DATA (FULL, SAFE) ===== */
const radarRegions = {
  "CONUS": { loop: "CONUS-LARGE" },
  "Northwest": { loop:"PACNORTHWEST", states:{
    "WA":[["KATX","Seattle"],["KLGX","Langley Hill"],["KOTX","Spokane"]],
    "OR":[["KRTX","Portland"],["KMAX","Medford"]],
    "ID":[["KCBX","Boise"]],
    "MT":[["KTFX","Great Falls"],["KMSX","Missoula"],["KGGW","Glasgow"]]
  }},
  "Southwest": { loop:"PACSOUTHWEST", states:{
    "CA":[["KMUX","San Jose"],["KHNX","Hanford"],["KSOX","Santa Ana"],["KVTX","Los Angeles"],["KNKX","San Diego"],["KVBX","Vandenberg"]],
    "NV":[["KRGX","Reno"],["KLRX","Elko"]],
    "AZ":[["KIWA","Phoenix"],["KEMX","Tucson"],["KFSX","Flagstaff"]],
    "UT":[["KICX","Cedar City"]],
    "NM":[["KABX","Albuquerque"],["KFDX","Cannon AFB"]]
  }},
  "Northern Plains": { loop:"UPPERMISSVLY", states:{
    "ND":[["KBIS","Bismarck"],["KMBX","Minot"]],
    "SD":[["KFSD","Sioux Falls"],["KABR","Aberdeen"]],
    "NE":[["KOAX","Omaha"],["KUEX","Hastings"],["KLNX","North Platte"]],
    "WY":[["KCYS","Cheyenne"],["KRIW","Riverton"]]
  }},
  "Southern Plains": { loop:"SOUTHPLAINS", states:{
    "TX":[["KFWS","Fort Worth"],["KHGX","Houston"],["KBRO","Brownsville"],["KAMA","Amarillo"],["KLBB","Lubbock"]],
    "OK":[["KTLX","Oklahoma City"],["KINX","Tulsa"],["KFDR","Frederick"]],
    "KS":[["KICT","Wichita"],["KDDC","Dodge City"],["KTWX","Topeka"]]
  }},
  "Midwest": { loop:"MIDWEST", states:{
    "MN":[["KMPX","Minneapolis"],["KDLH","Duluth"]],
    "IA":[["KDMX","Des Moines"],["KDVN","Davenport"]],
    "MO":[["KLSX","St. Louis"],["KEAX","Kansas City"]],
    "WI":[["KMKX","Milwaukee"],["KGRB","Green Bay"]],
    "IL":[["KLOT","Chicago"],["KILX","Lincoln"]],
    "IN":[["KIND","Indianapolis"],["KIWX","Northern Indiana"]],
    "MI":[["KDTX","Detroit"],["KGRR","Grand Rapids"]],
    "OH":[["KCLE","Cleveland"],["KILN","Wilmington"]]
  }},
  "Southeast": { loop:"SOUTHEAST", states:{
    "FL":[["KJAX","Jacksonville"],["KTBW","Tampa"],["KMLB","Melbourne"],["KAMX","Miami"]],
    "GA":[["KFFC","Atlanta"]],
    "AL":[["KBMX","Birmingham"],["KHTX","Huntsville"]],
    "TN":[["KOHX","Nashville"],["KNQA","Memphis"]],
    "KY":[["KLVX","Louisville"],["KPAH","Paducah"]],
    "SC":[["KCAE","Columbia"]],
    "NC":[["KRAX","Raleigh"],["KLTX","Wilmington"]],
    "LA":[["KLCH","Lake Charles"],["KSHV","Shreveport"]],
    "MS":[["KDGX","Jackson"]]
  }},
  "Northeast": { loop:"NORTHEAST", states:{
    "NY":[["KBUF","Buffalo"],["KOKX","New York City"],["KENX","Albany"]],
    "PA":[["KPBZ","Pittsburgh"],["KCCX","State College"]],
    "MA":[["KBOX","Boston"]],
    "NJ":[["KDIX","Mount Holly"]],
    "CT":[["KBOX","Hartford"]],
    "VT":[["KBTV","Burlington"]],
    "NH":[["KGYX","Gray"]],
    "ME":[["KGYX","Gray"],["KCAR","Caribou"]],
    "MD":[["KLWX","Washington DC"]],
    "VA":[["KAKQ","Wakefield"],["KFCX","Blacksburg"]],
    "WV":[["KRLX","Charleston"]]
  }}
};

function initRadar(){
  regionSelect.innerHTML="";
  Object.keys(radarRegions).forEach(r=>{
    regionSelect.innerHTML+=`<option value="${r}">${r}</option>`;
  });
  regionSelect.value="Northwest";
  handleRegionChange();
}

function handleRegionChange(){
  const r=radarRegions[regionSelect.value];
  if(regionSelect.value==="CONUS"){
    radarImage.src="https://radar.weather.gov/ridge/standard/CONUS-LARGE_loop.gif";
    stateSelect.innerHTML="";
    radarSelect.innerHTML="";
    return;
  }
  radarImage.src=`https://radar.weather.gov/ridge/standard/${r.loop}_loop.gif`;
  stateSelect.innerHTML=`<option value="">Select State</option>`;
  radarSelect.innerHTML="";
  Object.keys(r.states).forEach(s=>{
    stateSelect.innerHTML+=`<option value="${s}">${s}</option>`;
  });
}

function populateRadars(){
  radarSelect.innerHTML=`<option value="">Select City</option>`;
  const r=radarRegions[regionSelect.value];
  if(!stateSelect.value) return;
  r.states[stateSelect.value].forEach(site=>{
    radarSelect.innerHTML+=`<option value="${site[0]}">${site[1]}</option>`;
  });
}

function changeRadar(){
  if(!radarSelect.value) return;
  radarImage.src=`https://radar.weather.gov/ridge/standard/${radarSelect.value}_loop.gif`;
}

regionSelect.onchange=handleRegionChange;
stateSelect.onchange=populateRadars;
radarSelect.onchange=changeRadar;
initRadar();

/* ===== CITY TEMPS ===== */
async function updateCityTemps(){
  const items=document.querySelectorAll(".city-item");
  for(const item of items){
    const s=item.dataset.station;
    try{
      const r=await fetch(`https://api.weather.gov/stations/${s}/observations/latest`);
      const j=await r.json();
      const c=j.properties.temperature.value;
      item.querySelector(".city-temp").textContent =
        c==null?"--":Math.round(c*9/5+32)+"°F";
    }catch{
      item.querySelector(".city-temp").textContent="--";
    }
  }
}
updateCityTemps();
setInterval(updateCityTemps,300000);

  /* ===== AUTO REFRESH IMAGES (EVERY 5 MINUTES) ===== */
setInterval(() => {

  /* Current Conditions Temperature Map */
  const tempMap = document.getElementById("tempMapImage");
  if (tempMap) {
    tempMap.src =
      "https://data.mesonet.org/data/public/noaa/metar/maps/realtime/latest.tair.png?ts=" +
      Date.now();
  }

  /* Satellite */
  const sat = document.getElementById("satImage");
  if (sat) {
    sat.src = sat.src.split("?")[0] + "?ts=" + Date.now();
  }

  /* Radar */
  const radar = document.getElementById("radarImage");
  if (radar) {
    radar.src = radar.src.split("?")[0] + "?ts=" + Date.now();
  }

}, 300000); // 300000 ms = 5 minutes

/* ===== TEMP MAP HOVER / TAP TOGGLE ===== */
const airTempURL = "https://data.mesonet.org/data/public/noaa/metar/maps/realtime/latest.tair.png";
const feelsLikeURL = "https://data.mesonet.org/data/public/noaa/metar/maps/realtime/latest.tapp.png";

const tempMap = document.getElementById("tempMapImage");
const feelsToggle = document.getElementById("feelsToggle");

if (tempMap && feelsToggle) {

  // Desktop hover
  feelsToggle.addEventListener("mouseenter", () => {
    tempMap.src = feelsLikeURL + "?ts=" + Date.now();
  });

  feelsToggle.addEventListener("mouseleave", () => {
    tempMap.src = airTempURL + "?ts=" + Date.now();
  });

let showingFeels = false;
feelsToggle.addEventListener("click", () => {
  showingFeels = !showingFeels;

  tempMap.src = (showingFeels ? feelsLikeURL : airTempURL) + "?ts=" + Date.now();

  // visual active state (mobile)
  feelsToggle.classList.toggle("active", showingFeels);
});

}
/* ===== FORCE AIR TEMP MAP BACK EVERY 5 MIN ===== */
setInterval(() => {
  const tempMap = document.getElementById("tempMapImage");
  if (tempMap) {
    tempMap.src =
      "https://data.mesonet.org/data/public/noaa/metar/maps/realtime/latest.tair.png?ts=" +
      Date.now();
  }
}, 300000);



/* ===== <script> ===== */

const ccSelect=document.getElementById("currentCitySelect");
const mapWrap=document.getElementById("ccMapWrap");
const cityWrap=document.getElementById("ccCityWrap");


let chart;

async function loadCity(lat,lon){

mapWrap.style.display="none";
cityWrap.style.display="block";

const p=await fetch(`https://api.weather.gov/points/${lat},${lon}`);
const pj=await p.json();

const city=pj.properties.relativeLocation.properties.city+", "+pj.properties.relativeLocation.properties.state;
document.getElementById("ccCity").textContent=city;

const stationListResponse = await fetch(pj.properties.observationStations);
const stationListJSON = await stationListResponse.json();
const stationFeatures = stationListJSON.features;

// OPTIONAL: a priority list of known good airport stations
const preferredStations = [
  "https://api.weather.gov/stations/KPDX", // Portland International Airport
  "https://api.weather.gov/stations/PDX",  // alternate Portland naming
  "https://api.weather.gov/stations/KSEA", // Seattle Airport
  "https://api.weather.gov/stations/KPDX1" // example — add more as needed
];

// Try to find a preferred station first
let stationURL = null;
for (const pref of preferredStations) {
  const found = stationFeatures.find(s => s.id === pref);
  if (found) {
    stationURL = found.id;
    break;
  }
}

// If no preferred found, use the first one
if (!stationURL && stationFeatures.length > 0) {
  stationURL = stationFeatures[0].id;
}


/* last 12 hours */
const end=new Date().toISOString();
const start=new Date(Date.now()-12*3600000).toISOString();

const obs=await fetch(`${station}/observations?start=${start}&end=${end}`);
const oj=await obs.json();

const temps=[];
const labels=[];

oj.features.reverse().forEach(o=>{
  if(o.properties.temperature.value){
    temps.push(o.properties.temperature.value*9/5+32);
    labels.push(new Date(o.properties.timestamp).toLocaleTimeString([], {hour:'2-digit'}));
  }
});

const latest=oj.features[oj.features.length-1].properties;

ccTemp.textContent=Math.round(latest.temperature.value*9/5+32)+"°";
ccFeels.textContent = latest.apparentTemperature?.value
  ? "Feels Like " + Math.round(latest.apparentTemperature.value*9/5+32) + "°"
  : "";

ccWx.innerHTML="Sky <span>"+latest.textDescription+"</span>";

const windDir = latest.windDirection?.value
  ? ["N","NE","E","SE","S","SW","W","NW"][Math.round(latest.windDirection.value/45)%8]
  : "";

ccWind.innerHTML="Wind <span>"+Math.round(latest.windSpeed.value*2.237)+" mph "+windDir+"</span>";

ccHum.innerHTML="Humidity <span>"+Math.round(latest.relativeHumidity.value)+"%</span>";

ccDew.innerHTML="Dew Point <span>"+Math.round(latest.dewpoint.value*9/5+32)+"°</span>";

ccSun.innerHTML="Sun <span>—</span>";
ccUV.innerHTML="UV <span>—</span>";

ccUpdated.textContent="Updated "+new Date(latest.timestamp).toLocaleTimeString();


/* Chart */
if(chart) chart.destroy();

const ctx=document.getElementById("ccChart").getContext("2d");

chart=new Chart(ctx,{
 type:"line",
 data:{
   labels,
   datasets:[{
     data:temps,
     borderWidth:3,
     tension:.4,
     fill:true,
     pointRadius:0,
     borderColor:"#38bdf8",
     backgroundColor:(ctx)=>{
       const g=ctx.chart.ctx.createLinearGradient(0,0,0,200);
       g.addColorStop(0,"rgba(250,204,21,.45)");
       g.addColorStop(.5,"rgba(56,189,248,.25)");
       g.addColorStop(1,"rgba(37,99,235,.15)");
       return g;
     }
   }]
 },
 options:{
   plugins:{
     legend:{display:false},
     title:{
       display:true,
       text:"Temperature – Past 12 Hours",
       color:"#9ca3af",
       padding:6
     }
   },
  scales:{
  x:{
    ticks:{
      color:"#64748b",
      maxTicksLimit:12
    },
    grid:{display:false}
  },

  y:{
    ticks:{
      color:"#64748b",
      padding:6
    },
    grid:{color:"rgba(255,255,255,.04)"},
    grace:"20%"
  }
}

 }
});



}

ccSelect.addEventListener("change",()=>{

 if(ccSelect.value==="US"){
   cityWrap.style.display="none";
   mapWrap.style.display="block";

   // Show Feels Like when US map is active
   if(feelsToggle) feelsToggle.style.display="inline";

   return;
 }

 // Hide Feels Like when city mode is active
 if(feelsToggle) feelsToggle.style.display="none";

 const [lat,lon]=ccSelect.value.split(",");
 loadCity(lat,lon);
});


  


  
  
</script>
<script>
/* ===== SAFE 7-DAY FORECAST MODULE ===== */
(function(){

const grid = document.getElementById("forecastGrid");
const tsEl = document.getElementById("forecastTimestamp");
const refreshBtn = document.getElementById("forecastRefreshBtn");
const citySelect = document.getElementById("forecastCitySelect");

if(!grid || !citySelect) return;

let lat = 45.5152;
let lon = -122.6784;

async function fetchForecast(){
  try{
    grid.innerHTML = '<div class="loader">Loading forecast…</div>';

    const apiPoints = `https://api.weather.gov/points/${lat},${lon}`;
    const p = await fetch(apiPoints);
    const pj = await p.json();

    const forecastUrl = pj.properties.forecast;
    const r = await fetch(forecastUrl);
    const j = await r.json();

    const periods = j.properties.periods || [];

    const days = [];

    for(let i=0;i<periods.length && days.length<7;i++){
      if(periods[i].isDaytime){
        const night = periods[i+1] && !periods[i+1].isDaytime ? periods[i+1] : null;

        days.push({
          name: periods[i].name,
          icon: periods[i].icon,
          hi: periods[i].temperature,
          lo: night ? night.temperature : "",
          desc: periods[i].shortForecast,
          wind: periods[i].windSpeed,
          pop: periods[i].probabilityOfPrecipitation?.value
        });
      }
    }

    grid.innerHTML = "";

    days.forEach(d=>{
      const card=document.createElement("div");
      card.className="fc-card";

      card.innerHTML=`
        <div class="fc-day">${d.name}</div>
        <div class="fc-icon"><img src="${d.icon}"></div>
        <div class="fc-temp">
          <span class="hi">${d.hi}°</span>
          <span class="lo">${d.lo}°</span>
        </div>
        <div class="fc-desc">${d.desc}</div>
      `;

      grid.appendChild(card);
    });

    tsEl.textContent="Last updated: "+new Date().toLocaleString();

  }catch(e){
    console.error(e);
    grid.innerHTML="<div class='loader'>Forecast unavailable</div>";
  }
}

/* Initial load */
fetchForecast();

/* Refresh button */
refreshBtn.addEventListener("click", fetchForecast);

/* City change */
citySelect.addEventListener("change",()=>{
  const parts=citySelect.value.split(",");
  lat=parts[0];
  lon=parts[1];
  fetchForecast();
});

/* Auto refresh hourly */
setInterval(fetchForecast,3600000);

})();
</script>

</div> <!-- last panel / content -->

<div class="footer">
  <div class="social-bar">
    <a class="ig" href="https://www.instagram.com/iloveweather/" target="_blank">◎</a>
    <a class="fb" href="https://www.facebook.com/WeatherJefe/" target="_blank">f</a>
    <a class="th" href="https://www.threads.com/@iloveweather" target="_blank">@</a>
    <a class="in" href="https://www.linkedin.com/in/jeff-forgeron-447ab846" target="_blank">in</a>
  </div>
</div>

</body>



</body>
</html>
