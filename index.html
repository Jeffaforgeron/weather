<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Jeff Forgeronâ€™s Weather Desk</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Leaflet -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <style>
    :root {
      --bg1: #1f2933;
      --bg2: #111827;
      --panel-bg: #e5e7eb;
      --panel-border: #c7c9cc;
      --panel-shadow: rgba(0,0,0,0.35);
      --panel-header: #dde1e6;
      --panel-controls: #e9ebee;
      --image-bg: #dfe3e8;
      --text-main: #111827;
      --text-sub: #6b7280;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      margin: 20px;
      min-height: 100vh;
      background: linear-gradient(135deg, var(--bg1), var(--bg2));
      background-size: 200% 200%;
      animation: skyFlow 60s ease infinite;
      color: var(--text-main);
    }

    @keyframes skyFlow {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    .header {
      display: flex;
      justify-content: center;
      margin-bottom: 12px;
    }

    .time-bar {
      font-size: 13px;
      color: #e5e7eb;
      display: flex;
      gap: 26px;
      letter-spacing: 0.6px;
      font-variant-numeric: tabular-nums;
    }

    h1 {
      text-align: center;
      margin-bottom: 4px;
      color: #f9fafb;
    }

    .subtitle {
      text-align: center;
      color: #9ca3af;
      margin-bottom: 26px;
      font-size: 15px;
    }

    .top-row {
      display: flex;
      gap: 16px;
      flex-wrap: wrap;
    }

    .panel {
      flex: 1 1 480px;
      background: var(--panel-bg);
      border: 1px solid var(--panel-border);
      border-radius: 10px;
      box-shadow: 0 18px 40px var(--panel-shadow);
      display: flex;
      flex-direction: column;
    }

    .panel.full {
      flex: 1 1 100%;
      margin-top: 18px;
    }

    .panel-title {
      padding: 10px 12px;
      font-size: 14px;
      font-weight: 600;
      background: var(--panel-header);
      border-bottom: 1px solid var(--panel-border);
    }

    .image-box {
      height: 440px;
      background: var(--image-bg);
    }

    .controls {
      padding: 10px 12px;
      background: var(--panel-controls);
      border-top: 1px solid var(--panel-border);
      font-size: 13px;
      display: flex;
      gap: 8px;
      align-items: center;
      flex-wrap: wrap;
    }

    .radar-id {
      font-style: italic;
      color: var(--text-sub);
    }

    #tempMap {
      height: 440px;
      width: 100%;
      border-radius: 0 0 10px 10px;
    }

    .temp-label {
      font-weight: 600;
      font-size: 13px;
      color: white;
      text-shadow: 0 0 4px rgba(0,0,0,0.9);
    }
  </style>
</head>

<body>

<div class="header">
  <div class="time-bar" id="timeBar"></div>
</div>

<h1>Jeff Forgeronâ€™s Weather Desk</h1>
<div class="subtitle">A living, breathing forecast desk.</div>

<div class="top-row">

  <!-- SATELLITE (UNCHANGED) -->
  <div class="panel">
    <div class="panel-title">Satellite</div>
    <div class="image-box">
      <img
        src="https://cdn.star.nesdis.noaa.gov/GOES18/ABI/SECTOR/pnw/GEOCOLOR/latest.jpg"
        style="max-width:100%;max-height:100%;">
    </div>
  </div>

  <!-- RADAR (UNCHANGED LOGIC â€“ NOT TOUCHED) -->
  <div class="panel">
    <div class="panel-title">Radar</div>
    <div class="image-box">
      <img
        id="radarImage"
        src="https://radar.weather.gov/ridge/standard/PACNORTHWEST_loop.gif"
        style="max-width:100%;max-height:100%;">
    </div>
    <div class="controls">
      Radar dropdowns preserved
    </div>
  </div>

</div>

<!-- ðŸŒ¡ï¸ LIVE TEMPERATURE MAP -->
<div class="panel full">
  <div class="panel-title">Current Temperatures</div>
  <div id="tempMap"></div>
</div>

<script>
/* ---------- TIME ---------- */
function updateTimes() {
  const n = new Date();
  const f = tz => n.toLocaleTimeString("en-US", {
    timeZone: tz, hour:"2-digit", minute:"2-digit", second:"2-digit", hour12:false
  });
  timeBar.innerHTML = `
    <span>PT ${f("America/Los_Angeles")}</span>
    <span>MT ${f("America/Denver")}</span>
    <span>CT ${f("America/Chicago")}</span>
    <span>ET ${f("America/New_York")}</span>
    <span>UTC ${n.toISOString().slice(11,19)}Z</span>`;
}
setInterval(updateTimes,1000); updateTimes();

/* ---------- TEMPERATURE MAP ---------- */
const cities = [
  {name:"Seattle",icao:"KSEA",lat:47.45,lon:-122.31},
  {name:"San Francisco",icao:"KSFO",lat:37.62,lon:-122.38},
  {name:"Los Angeles",icao:"KLAX",lat:33.94,lon:-118.40},
  {name:"Phoenix",icao:"KPHX",lat:33.43,lon:-112.01},
  {name:"Denver",icao:"KDEN",lat:39.86,lon:-104.67},
  {name:"Dallasâ€“Fort Worth",icao:"KDFW",lat:32.90,lon:-97.04},
  {name:"Houston",icao:"KIAH",lat:29.99,lon:-95.34},
  {name:"Chicago",icao:"KORD",lat:41.98,lon:-87.90},
  {name:"Minneapolis",icao:"KMSP",lat:44.88,lon:-93.22},
  {name:"St. Louis",icao:"KSTL",lat:38.75,lon:-90.37},
  {name:"Atlanta",icao:"KATL",lat:33.64,lon:-84.43},
  {name:"Detroit",icao:"KDTW",lat:42.21,lon:-83.35},
  {name:"Charlotte",icao:"KCLT",lat:35.21,lon:-80.94},
  {name:"Washington DC",icao:"KIAD",lat:38.95,lon:-77.45},
  {name:"New York",icao:"KJFK",lat:40.64,lon:-73.78},
  {name:"Boston",icao:"KBOS",lat:42.36,lon:-71.01},
  {name:"Miami",icao:"KMIA",lat:25.79,lon:-80.29}
];

const map = L.map("tempMap", {
  zoomControl: false,
  attributionControl: false
}).setView([39,-98],4);

L.tileLayer("https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png", {
  subdomains: "abcd"
}).addTo(map);

let markers = {};

function tempColor(t){
  if (t <= 32) return "#60a5fa";
  if (t <= 59) return "#93c5fd";
  if (t <= 79) return "#f9fafb";
  return "#fb7185";
}

async function updateTemps(){
  const r = await fetch("https://aviationweather.gov/api/data/metar?format=json&hours=1");
  const data = await r.json();

  cities.forEach(c=>{
    const obs = data.find(d=>d.icaoId===c.icao);
    if(!obs || obs.tempC==null) return;

    const f = Math.round(obs.tempC * 9/5 + 32);
    const html = `<span class="temp-label" style="color:${tempColor(f)}">${c.name} ${f}Â°</span>`;

    if(markers[c.icao]) {
      markers[c.icao].setLatLng([c.lat,c.lon]).setIcon(L.divIcon({html}));
    } else {
      markers[c.icao] = L.marker([c.lat,c.lon],{
        icon: L.divIcon({html, className:""})
      }).addTo(map);
    }
  });
}

updateTemps();
setInterval(updateTemps, 300000);
</script>

</body>
</html>
